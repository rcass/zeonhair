var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,n,e){b instanceof String&&(b=String(b));for(var a=b.length,c=0;c<a;c++){var d=b[c];if(n.call(e,d,c,b))return{i:c,v:d}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,n,e){b!=Array.prototype&&b!=Object.prototype&&(b[n]=e.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,n,e,a){if(n){e=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var c=b[a];c in e||(e[c]={});e=e[c]}b=b[b.length-1];a=e[b];n=n(a);n!=a&&null!=n&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6-impl","es3");window.themifybuilderapp=window.themifybuilderapp||{};
(function(b){var n=b.ui.sortable.prototype._mouseStart;b.ui.sortable.prototype._mouseStart=function(a,c,b){this._trigger("beforeStart",a,this._uiHash());n.apply(this,[a,c,b])};var e=themifybuilderapp={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{},Controls:{}},Forms:{},Utils:{},Instances:{Builder:{}},cache:{repeaterElements:{}}};"undefined"===typeof b.fn.themifySerializeObject&&(b.fn.themifySerializeObject=function(){var a={},c=this.serializeArray();
b.each(c,function(){if(void 0!==a[this.name]&&this.value)a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value);else if(this.value){var c=b("#themify_builder_lightbox_container #"+this.name);if(!c.length||void 0===c.data("default")||this.value!=c.data("default")||"solid"===this.value||c.hasClass("themify-checkbox"))a[this.name]=this.value}});return a});e.editing=!1;e.activeBreakPoint="desktop";e.Models.Module=Backbone.Model.extend({defaults:{elType:"module",mod_name:"",mod_settings:{}},
initialize:function(){e.Models.Registry.register(this.cid,this)},toRenderData:function(){return{slug:this.get("mod_name"),name:this.get("mod_name"),excerpt:this.getExcerpt()}},getExcerpt:function(){var a=this.get("mod_settings").content_text||this.get("mod_settings").content_box||"";return this.limitString(a,100)},limitString:function(a,c){a=this.stripHtml(a);return a.toString().length>c?a.toString().substr(0,c):a.toString()},stripHtml:function(a){var c=document.createElement("DIV");c.innerHTML=a;
return c.textContent||c.innerText||""},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)},getPreviewSettings:function(){return _.extend({cid:this.cid},this.get("mod_settings"),this.get("temp_settings"))}});e.Models.SubRow=Backbone.Model.extend({defaults:{elType:"subrow",row_order:0,gutter:"gutter-default",column_alignment:"",fullwidthvideo:"",mutevideo:"",unloopvideo:"",desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_mobile:"mobile-auto",col_tablet:"tablet-auto",
cols:{},styling:{}},initialize:function(){e.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});e.Models.Column=Backbone.Model.extend({defaults:{elType:"column",column_order:"",grid_class:"",component_name:"column",fullwidthvideo:"",mutevideo:"",unloopvideo:"",modules:{},styling:{}},initialize:function(){e.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});
e.Models.Row=Backbone.Model.extend({defaults:{elType:"row",row_order:0,gutter:"gutter-default",column_alignment:"",desktop_dir:"ltr",tablet_dir:"ltr",mobile_dir:"ltr",col_mobile:"mobile-auto",col_tablet:"tablet-auto",fullwidthvideo:"",mutevideo:"",unloopvideo:"",cols:{},styling:{}},initialize:function(){e.Models.Registry.register(this.cid,this)},setData:function(a){this.set(a,{silent:!0});this.trigger("custom:change",this)}});e.Collections.Rows=Backbone.Collection.extend({model:e.Models.Row});e.Models.Registry=
{items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,c){a.destroy()});this.items={};console.log("destroy registry")}};e.Models.setValue=function(a,c,b){b=b||!1;e.Models.Registry.lookup(a).set(c,{silent:b})};e.vent=_.extend({},Backbone.Events);e.Views.register_module=function(a,c){"default"!==a&&(this.Modules[a]=this.Modules["default"].extend(c))};e.Views.init_module=
function(a,c){c=c||"default";_.isUndefined(a.mod_settings)&&!_.isUndefined(themifyBuilder.modules[a.mod_name].defaults)&&(a.mod_settings=_.extend({},themifyBuilder.modules[a.mod_name].defaults));var b=a instanceof e.Models.Module?a:new e.Models.Module(a),f=new (this.get_module(c))({model:b,type:c});return{model:b,view:f}};e.Views.get_module=function(a){a=a||"default";return this.module_exists(a)?this.Modules[a]:this.Modules["default"]};e.Views.unregister_module=function(a){"default"!==a&&this.module_exists(a)&&
delete this.Modules[a]};e.Views.module_exists=function(a){return this.Modules.hasOwnProperty(a)};e.Views.register_column=function(a,b){"default"!==a&&(this.Columns[a]=this.Columns["default"].extend(b))};e.Views.init_column=function(a,b){b=b||"default";var c=a instanceof e.Models.Column?a:new e.Models.Column(a),f=new (this.get_column(b))({model:c,type:b});return{model:c,view:f}};e.Views.get_column=function(a){a=a||"default";return this.column_exists(a)?this.Columns[a]:this.Columns["default"]};e.Views.unregister_column=
function(a){"default"!==a&&this.column_exists(a)&&delete this.Columns[a]};e.Views.column_exists=function(a){return this.Columns.hasOwnProperty(a)};e.Views.register_subrow=function(a,b){"default"!==a&&(this.SubRows[a]=this.SubRows["default"].extend(b))};e.Views.init_subrow=function(a,b){b=b||"default";var c=a instanceof e.Models.SubRow?a:new e.Models.SubRow(a),f=new (this.get_subrow(b))({model:c,type:b});return{model:c,view:f}};e.Views.get_subrow=function(a){a=a||"default";return this.subrow_exists(a)?
this.SubRows[a]:this.SubRows["default"]};e.Views.unregister_subrow=function(a){"default"!==a&&this.subrow_exists(a)&&delete this.SubRows[a]};e.Views.subrow_exists=function(a){return this.SubRows.hasOwnProperty(a)};e.Views.register_row=function(a,b){"default"!==a&&(this.Rows[a]=this.Rows["default"].extend(b))};e.Views.init_row=function(a,b){b=b||"default";var c=a instanceof e.Models.Row?a:new e.Models.Row(a),f=new (this.get_row(b))({model:c,type:b});return{model:c,view:f}};e.Views.get_row=function(a){a=
a||"default";return this.row_exists(a)?this.Rows[a]:this.Rows["default"]};e.Views.unregister_row=function(a){"default"!==a&&this.row_exists(a)&&delete this.Rows[a]};e.Views.row_exists=function(a){return this.Rows.hasOwnProperty(a)};e.Views.BaseElement=Backbone.View.extend({type:"default",menuTouched:[],events:{"click .themify_builder_copy_component":"copy","click .themify_builder_paste_component":"paste","click .themify_builder_import_component":"import","click .themify_builder_export_component":"export",
"hover .module_menu":"actionMenuHover","hover .row_menu":"actionMenuHover"},initialize:function(a){_.extend(this,_.pick(a,"type"));this.listenTo(this.model,"change",this.renderInlineData);this.listenTo(this.model,"custom:change",this.modelChange);this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.model,"custom:dom:update",this.domUpdate)},modelChange:function(a){this.$el.attr(_.extend({},_.result(this,"attributes")));this.render()},remove:function(){this.$el.remove()},domUpdate:function(){this.setElement(b('[data-cid="'+
this.model.cid+'"]'))},renderInlineData:function(){},copy:function(a){a.preventDefault();a.stopPropagation();console.log("copy");var c=b(a.currentTarget);var d={};a=ThemifyBuilderCommon.detectBuilderComponent(c);switch(a){case "row":case "sub-row":c=c.closest(".themify_builder_"+a.replace("-","_"));var f=c.index();f="row"===a?e.Utils._getRowSettings(c,f):e.Utils._getSubRowSettings(c,f);d=JSON.stringify(f);"row"===a&&c.find(".themify_builder_dropdown").hide();break;case "module":c=c.closest(".active_module");
d=c.data("mod-name");c=JSON.parse(c.find(".themify_module_settings").find('script[type="text/json"]').text());d=JSON.stringify({mod_name:d,mod_settings:c});break;case "column":case "sub-column":d=c.closest(".themify_builder_col"),c=c.closest("column"===a?".themify_builder_row":".themify_builder_sub_row"),f=c.index(),f="column"===a?e.Utils._getRowSettings(c,f):e.Utils._getSubRowSettings(c,f),d=d.index(),d=f.cols[d],d=JSON.stringify(d)}ThemifyBuilderCommon.Clipboard.set(a,d)},paste:function(a){a.preventDefault();
a.stopPropagation();console.log("paste");var c=b(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);var d=ThemifyBuilderCommon.Clipboard.get(a);if(!1===d)ThemifyBuilderCommon.alertWrongPaste();else if(ThemifyBuilderCommon.confirmDataPaste()){var f=this.$el.closest("[data-postid]"),d=JSON.parse(d);e.vent.trigger("dom:observer:start",f,{cid:this.model.cid,value:this.model.toJSON()});if("column"===a||"sub-column"===a){var g=c.closest(".themify_builder_col"),h=c.closest("column"===a?".themify_builder_row":
".themify_builder_sub_row"),c=g.index(),h=h.index();d.column_order=c;d.grid_class=g.prop("class").replace("themify_builder_col","");"column"===a?d.row_order=h:(d.sub_row_order=h,d.row_order=g.closest(".themify_builder_row").index(),d.col_order=g.parents(".themify_builder_col").index());d.component_name=a}this.model.setData(d);e.vent.trigger("dom:builder:change");"visual"!==this.type&&e.vent.trigger("dom:observer:end",f,{cid:this.model.cid,value:this.model.toJSON()})}},"import":function(a){a.preventDefault();
a.stopPropagation();console.log("import");var c=b(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);var d={data:{action:"tfb_imp_component_data_lightbox_options"}};e.activeModel=e.Models.Registry.lookup(c.closest("[data-cid]").data("cid"));switch(a){case "row":case "sub-row":c=c.closest(".themify_builder_"+a.replace("-","_"));ThemifyBuilderCommon.highlightRow(c);break;case "module":var f=c.closest(".themify_builder_module");b(".themify_builder_module").removeClass("current_selected_module");
f.addClass("current_selected_module");break;case "column":case "sub-column":f=c.closest(".themify_builder_col"),c=c.closest("column"===a?".themify_builder_row":".themify_builder_sub_row"),d.data.indexData={row:c.index(),col:f.index()},ThemifyBuilderCommon.highlightColumn(f)}d.data.component=a;ThemifyBuilderCommon.Lightbox.open(d,null)},"export":function(a){a.preventDefault();a.stopPropagation();console.log("export");var c=this,d="";a=b(a.currentTarget);var f=ThemifyBuilderCommon.detectBuilderComponent(a),
g={data:{action:"tfb_exp_component_data_lightbox_options"}};switch(f){case "row":case "sub-row":var h=a.closest(".themify_builder_"+f.replace("-","_")),d=function(){var a=h.index(),a="row"===f?e.Utils._getRowSettings(h,a):e.Utils._getSubRowSettings(h,a);a.component_name=f;var a=JSON.stringify(a),d=b("#tfb_exp_"+f.replace("-","_")+"_data_field");d.val(a);c._autoSelectInputField(d);d.on("click",function(){c._autoSelectInputField(d)})};break;case "module":var k=a.closest(".active_module"),d=function(){var a=
k.data("mod-name"),d=JSON.parse(k.find(".themify_module_settings").find('script[type="text/json"]').text()),a=JSON.stringify({mod_name:a,mod_settings:d,component_name:"module"}),e=b("#tfb_exp_module_data_field");e.val(a);c._autoSelectInputField(e);e.on("click",function(){c._autoSelectInputField(e)})};break;case "column":case "sub-column":var h=a.closest("column"===f?".themify_builder_row":".themify_builder_sub_row"),l=a.closest(".themify_builder_col"),d=function(){var a=h.index(),a="column"===f?e.Utils._getRowSettings(h,
a):e.Utils._getSubRowSettings(h,a),d=l.index(),a=a.cols[d];a.component_name=f;var a=JSON.stringify(a),g=b("#tfb_exp_"+f.replace("-","_")+"_data_field");g.val(a);c._autoSelectInputField(g);g.on("click",function(){c._autoSelectInputField(g)})}}g.data.component=f;ThemifyBuilderCommon.Lightbox.open(g,d)},actionMenuHover:function(a){a.stopPropagation();var c=b(a.currentTarget);if("touchend"===a.type){a=c.closest(".themify_builder_row");var d=c.closest(".themify_builder_col"),e=c.closest(".themify_builder_module"),
g="row_"+a.index();0<d.length&&(g+="_col_"+d.index());0<e.length&&(g+="_mod_"+e.index());this.menuTouched[g]?(c.find(".themify_builder_dropdown").stop(!1,!0).hide(),a.css("z-index",""),ThemifyPageBuilder.menuTouched=[]):(d=this.$el,d.find(".themify_builder_dropdown").stop(!1,!0).hide(),d.find(".themify_builder_row").css("z-index",""),c.find(".themify_builder_dropdown").stop(!1,!0).show(),a.css("z-index","998"),this.menuTouched=[],this.menuTouched[g]=!0)}else"mouseenter"===a.type?c.find(".themify_builder_dropdown").stop(!1,
!0).show():"mouseleave"===a.type&&c.find(".themify_builder_dropdown").stop(!1,!0).hide()},getBuilderID:function(){return this.$el.closest("[data-postid]").data("postid")}});e.Views.BaseElement.extend=function(a){var b=this,d=Backbone.View.extend.apply(this,arguments);d.prototype.events=_.extend({},this.prototype.events,a.events);d.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};
return d};e.Views.Modules["default"]=e.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_module module-"+this.model.get("mod_name")+" active_module","data-mod-name":this.model.get("mod_name"),"data-cid":this.model.cid}},template:wp.template("builder_module_item"),events:{dblclick:"edit","click .themify_module_options":"edit","click .js--themify_builder_module_styling":"edit","click .themify_module_delete":"delete","click .themify_module_duplicate":"duplicate"},
initialize:function(){this.listenTo(this,"edit",this.edit);this.listenTo(this.model,"custom:element:updatestate",this.removeInitialStateClass)},render:function(){this.$el.html(this.template(this.model.toRenderData()));this.renderInlineData();return this},renderInlineData:function(){this.$(".themify_module_settings").find('script[type="text/json"]').text(JSON.stringify(this.model.get("mod_settings")))},removeInitialStateClass:function(){this.$el.removeClass("tb_module_state_unsaved")},edit:function(a,
c){var d=_.isNull(a)||_.isUndefined(a)?"":b(a.target).data("module-name");if("undefined"==typeof d||""==d)d=_.isNull(a)||_.isUndefined(a)?"":b(a.target).closest(".themify_builder_module_front").data("mod-name");if(""!=d&&-1!==themifyBuilder.excludedModules.indexOf(d))a.preventDefault(),alert(themifyBuilder.i18n.editExcludedModule);else{var f=!1;_.isNull(a)||_.isUndefined(a)?f=!0:(a.preventDefault(),this.model.set({styleClicked:b(a.currentTarget).hasClass("themify_builder_module_styling")},{silent:!0}));
c=c||!1;e.activeModel=this.model;var g=this,h=this.model.get("mod_settings");b(".module_menu .themify_builder_dropdown").hide();this.highlightModuleBack(this.$el);c||e.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:e.activeModel.cid,value:{mod_settings:e.activeModel.get("mod_settings")}});var k=function(a){a.setAttribute("data-form-state",c?"new":"edit");if("desktop"!==e.activeBreakPoint){var d=b("#themify_builder_options_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get();
h=_.omit(h,d);!_.isUndefined(h["breakpoint_"+e.activeBreakPoint])&&_.isObject(h["breakpoint_"+e.activeBreakPoint])&&(h=_.extend(h,h["breakpoint_"+e.activeBreakPoint]))}"visual"===g.type&&e.liveStylingInstance.init(g.$el.children(".module"),h);var k=a.getElementsByClassName("tfb_lb_option"),l,v=!_.isEmpty(h);for(l=0;l<k.length;++l){d=b(k[l]);var m=d.attr("id");var p=h[m];d.hasClass("themify-gradient")?e.Utils.createGradientPicker(d,p):d.hasClass("tf-radio-input-container")&&d.find(":checked").trigger("change");
if(p)if(d.hasClass("select_menu_field"))isNaN(p)?d.find("option[value='"+p+"']").attr("selected","selected"):d.find("option[data-termid='"+p+"']").attr("selected","selected");else if(d.is("select"))d.val(p).trigger("change");else if(d.hasClass("themify-builder-uploader-input")){m=p;var u=b("<img/>",{src:m,width:50,height:50});m?(d.val(m),d.parent().find(".img-placeholder").empty().html(u).parent().show()):d.parent().find(".thumb_preview").hide()}else if(d.hasClass("themify-option-query-cat")){m=d.parent();
var u=m.find(".query_category_multiple"),w=p.split("|")[0];m.find("option[value='"+w+"']").attr("selected","selected");u.val(w)}else if(d.hasClass("themify_builder_row_js_wrapper")){m=0;e.cache.repeaterElements[d.attr("id")]=d.find(".tb_repeatable_field").first().clone();0<p.length&&(m=p.length-1);for(u=0;u<m;u++)d.parent().find(".add_new a").first().trigger("click");d.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(c){c=b(this);var d=c.attr("id"),
f=c.hasClass("tfb_lb_wp_editor")?c.attr("name"):c.data("input-id");f||(f=d);d=p[a][""+f+""];if(c.hasClass("themify-builder-uploader-input")){var g=b("<img/>",{src:d,width:50,height:50});d?(c.val(d),c.parent().find(".img-placeholder").empty().html(g).parent().show()):c.parent().find(".thumb_preview").hide()}else if(c.hasClass("tf-radio-choice"))c.find("input[value='"+d+"']").attr("checked","checked").trigger("change");else if(c.hasClass("themify-layout-icon"))c.find("#"+d).addClass("selected");else if(c.hasClass("themify-checkbox"))for(g in d)c.find("input[value='"+
d[g]+"']").prop("checked",!0);else c.is("input, textarea, select")&&c.val(d);c.hasClass("tfb_lb_wp_editor")&&e.Views.init_control("wp_editor",{el:c});c.data("control-binding")&&c.data("control-type")&&e.Views.init_control(c.data("control-type"),{el:c,binding_type:c.data("control-binding")})})})}else if(d.hasClass("tf-radio-input-container"))d.find("input[value='"+p+"']").attr("checked","checked").trigger("change"),m=d.find('input[name="'+m+'"]:checked').val(),d.hasClass("tf-option-checkbox-enable")&&
(d.find(".tf-group-element").hide(),d.find(".tf-group-element-"+m).show());else if(d.is('input[type!="checkbox"][type!="radio"], textarea'))d.val(p).trigger("change"),!c&&d.is("textarea")&&d.hasClass("tf-thumbs-preview")&&g.getShortcodePreview(d,p);else if(d.hasClass("themify-checkbox")){var r=p,r=r.split("|");d.find(".tf-checkbox").each(function(){b(this).prop("checked",-1!==b.inArray(b(this).val(),r))})}else d.hasClass("themify-layout-icon")?d.find("#"+p).addClass("selected"):d.html(p);else d.hasClass("themify-layout-icon")?
d.children().first().addClass("selected"):d.hasClass("themify-builder-uploader-input")?d.parent().find(".thumb_preview").hide():d.hasClass("tf-radio-input-container")?(d.find('input[type="radio"]').first().prop("checked"),m=d.find('input[name="'+m+'"]:checked').val(),d.hasClass("tf-option-checkbox-enable")&&(d.find(".tf-group-element").hide(),d.find(".tf-group-element-"+m).show())):d.hasClass("themify_builder_row_js_wrapper")?(e.cache.repeaterElements[d.attr("id")]=d.find(".tb_repeatable_field").first().clone(),
d.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(a){a=b(this);a.hasClass("tfb_lb_wp_editor")&&e.Views.init_control("wp_editor",{el:a});a.data("control-binding")&&a.data("control-type")&&e.Views.init_control(a.data("control-type"),{el:a,binding_type:a.data("control-binding")})})})):d.hasClass("themify-checkbox")&&v?d.find(".tf-checkbox").each(function(){b(this).prop("checked",!1)}):d.is('input[type!="checkbox"][type!="radio"], textarea')&&v&&d.val("");
d.hasClass("tfb_lb_wp_editor")&&e.Views.init_control("wp_editor",{el:d});d.hasClass("themify_builder_row_js_wrapper")&&e.Views.init_control("repeater",{el:d,binding_type:d.data("control-binding")});d.data("control-binding")&&d.data("control-type")&&"repeater"!==d.data("control-type")&&e.Views.init_control(d.data("control-type"),{el:d,binding_type:d.data("control-binding")})}b("body").trigger("editing_module_option",[h]);b(".tf-option-checkbox-enable input:checked").trigger("change");g.model.get("styleClicked")&&
b('a[href="#themify_builder_options_styling"]').length&&b('a[href="#themify_builder_options_styling"]').trigger("click");f&&"gallery"===g.model.get("mod_name")&&b(".tf-gallery-btn",a).trigger("click");e.Utils.setColorPicker(a);e.Utils.builderPlupload("normal");g.moduleOptionsBinding();b(".themify_builder_tabs").tabs();g.applyAll_init();ThemifyBuilderCommon.fontPreview(b("#themify_builder_lightbox_container"),h);"visual"===g.type&&(ThemifyBuilderCommon.Lightbox.rememberRow(g),e.liveStylingInstance.addStyleDate(g.model.get("mod_name"),
themifyBuilder.element_style_rules[g.model.get("mod_name")]),e.styleSheet.rememberRules())};ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_module_"+this.model.get("mod_name")},function(a){setTimeout(function(){k(a)},400)})}},"delete":function(a){a.preventDefault();confirm(themifyBuilder.i18n.moduleDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),e.vent.trigger("dom:observer:start",a),
this.model.destroy(),e.vent.trigger("dom:observer:end",a),e.vent.trigger("dom:builder:change"))},duplicate:function(a){a.preventDefault();a=e.Views.init_module(this.model.toJSON(),this.type);var b=this.$el.closest("[data-postid]");e.vent.trigger("dom:observer:start",b);a.view.render().$el.insertAfter(this.$el);"visual"!==this.type&&(e.vent.trigger("dom:builder:change"),e.vent.trigger("dom:observer:end",b));a.view.trigger("component:duplicate")}});e.Views.Columns["default"]=e.Views.BaseElement.extend({tagName:"div",
attributes:function(){return{"class":"themify_builder_col module_column "+this.model.get("grid_class"),style:this.model.get("grid_width")?"width:"+this.model.get("grid_width")+"%":"","data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),"data-mutevideo":this.model.get("mutevideo"),"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_column_item"),events:{"click .themify_builder_option_column":"edit","click .js-column-menu-icon":"click_menu_icon"},
initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData);this.listenTo(this.model,"change:grid_class",this.renderAttrs)},renderAttrs:function(){this.$el.attr(_.extend({},_.result(this,"attributes")))},render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(!_.isEmpty(this.model.get("modules"))){var a=document.createDocumentFragment();_.each(this.model.get("modules"),function(b,d){if(_.isNull(b))return!0;_.isObject(b.mod_settings)?
b.mod_settings=e.Utils.removeEmptyFields(b.mod_settings):_.isObject(b.styling)&&(b.styling=e.Utils.removeEmptyFields(b.styling));var c=b&&_.isUndefined(b.cols)?e.Views.init_module(b,this.type):e.Views.init_subrow(b,this.type);a.appendChild(c.view.render().el)},this);this.$el.find(".themify_module_holder").append(a)}return this},renderInlineData:function(){var a=this.model.get("styling"),b="",d="",e="";_.isObject(a)&&(b=_.isEmpty(a.background_video)||"video"!==a.background_type?"":a.background_video)&&
!_.isEmpty(a.background_video_options)&&(d=-1!==a.background_video_options.indexOf("mute")?"mute":"",e=-1!==a.background_video_options.indexOf("unloop")?"unloop":"");this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":d,"data-unloopvideo":e});this.$el.children(".column-data-styling").attr("data-styling",JSON.stringify(a))},edit:function(a){a.preventDefault();a.stopPropagation();e.activeModel=this.model;var b=this;e.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:e.activeModel.cid,
value:{styling:e.activeModel.get("styling")}});ThemifyBuilderCommon.highlightColumn(this.$el);ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_column"},function(){e.Mixins.Builder.editComponent("column",b)})},click_menu_icon:function(a){a.preventDefault()}});e.Views.SubRows["default"]=e.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_sub_row module_subrow clearfix  module_subrow_"+
this.model.cid+" tb_element_cid_"+this.model.cid,"data-column-alignment":this.model.get("column_alignment"),"data-desktop_dir":this.model.get("desktop_dir"),"data-tablet_dir":this.model.get("tablet_dir"),"data-mobile_dir":this.model.get("mobile_dir"),"data-mobile":this.model.get("col_mobile"),"data-tablet":this.model.get("col_tablet"),"data-gutter":this.model.get("gutter"),"data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),"data-mutevideo":this.model.get("mutevideo"),
"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_sub_row_item"),events:{"click .themify_builder_style_subrow":"edit","click .sub_row_delete":"delete","click .sub_row_duplicate":"duplicate"},initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(!_.isUndefined(this.model.get("cols"))){var a=document.createDocumentFragment();_.each(this.model.get("cols"),
function(b,c){b.component_name="sub-column";_.isObject(b.styling)&&(b.styling=e.Utils.removeEmptyFields(b.styling));var d=e.Views.init_column(b,this.type);a.appendChild(d.view.render().el)},this);this.$el.find(".themify_builder_sub_row_content").append(a)}var c={},d=this.model.get("col_tablet"),f=this.model.get("col_mobile"),g=this.$el.find(".themify_builder_sub_row_content");c.desktop=this.model.get("desktop_dir");c.tablet=this.model.get("tablet_dir");c.mobile=this.model.get("mobile_dir");d||(d=
"tablet-auto");f||(f="mobile-auto");c.desktop||(c.desktop="ltr");c.tablet||(c.tablet="ltr");c.mobile||(c.mobile="ltr");var h=this.$el;b.each(c,function(a,b){"ltr"!==b&&h.find(".themify_builder_grid_"+a+" .themify_builder_column_direction").first().find("li").removeClass("selected").children(".column-dir-"+b).parent().addClass("selected")});"visual"===e.mode?g.removeClass("desktop-col-direction-ltr desktop-col-direction-rtl tablet-col-direction-ltr tablet-col-direction-rtl mobile-col-direction-ltr mobile-col-direction-rtl").addClass("tfb_grid_classes desktop-col-direction-"+
c.desktop+" tablet-col-direction-"+c.tablet+" mobile-col-direction-"+c.mobile):g.addClass("direction-"+c.desktop);var c=this.$el.find(".themify_builder_grid_mobile ."+f).first(),k=this.$el.find(".themify_builder_grid_tablet ."+d).first(),l=parseInt(c.data("col")),t=parseInt(k.data("col"));c.closest("li").addClass("selected");k.closest("li").addClass("selected");if(2===l||3===l)f+=" mobile-"+(2===l?"2col":"3col");if(2===t||3===t)d+=" tablet-"+(2===t?"2col":"3col");g.addClass(this.model.get("gutter")+
" "+f+" "+d);return this},renderInlineData:function(){var a=this.model.get("styling"),b="",d="",e="";_.isObject(a)&&(b=_.isEmpty(a.background_video)||"video"!==a.background_type?"":a.background_video)&&!_.isEmpty(a.background_video_options)&&(d=-1!==a.background_video_options.indexOf("mute")?"mute":"",e=-1!==a.background_video_options.indexOf("unloop")?"unloop":"");this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":d,"data-unloopvideo":e});this.$el.find(".gutter_select").val(this.model.get("gutter"));
this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').parent().addClass("selected").siblings().removeClass("selected");this.$el.children(".subrow-data-styling").attr("data-styling",JSON.stringify(a));"col_align_top"!==this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]')&&setTimeout(function(){this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').trigger("click")}.bind(this),400)},edit:function(a){a.preventDefault();a.stopPropagation();
e.activeModel=this.model;var b=this;e.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:e.activeModel.cid,value:{styling:e.activeModel.get("styling")}});ThemifyBuilderCommon.highlightSubRow(this.$el);ThemifyBuilderCommon.highlightColumn(this.$el.closest(".themify_builder_column"));ThemifyBuilderCommon.highlightRow(this.$el.closest(".themify_builder_row"));ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_subrow"},function(){e.Mixins.Builder.editComponent("sub-row",
b)})},"delete":function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.subRowDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),e.vent.trigger("dom:observer:start",a),this.model.destroy(),e.vent.trigger("dom:observer:end",a),e.vent.trigger("dom:builder:change"))},duplicate:function(a){a.preventDefault();a.stopPropagation();a=e.Views.init_subrow(e.Utils._getSubRowSettings(this.$el,this.$el.index()),this.type);var b=this.$el.closest("[data-postid]");e.vent.trigger("dom:observer:start",
b);a.view.render().$el.insertAfter(this.$el);a.view.trigger("component:duplicate");"visual"!==this.type&&(e.vent.trigger("dom:builder:change"),e.vent.trigger("dom:observer:end",b))}});e.Views.Rows["default"]=e.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_row module_row clearfix module_row_"+this.model.cid+" tb_element_cid_"+this.model.cid,"data-column-alignment":this.model.get("column_alignment"),"data-desktop_dir":this.model.get("desktop_dir"),"data-tablet_dir":this.model.get("tablet_dir"),
"data-mobile_dir":this.model.get("mobile_dir"),"data-mobile":this.model.get("col_mobile"),"data-tablet":this.model.get("col_tablet"),"data-gutter":this.model.get("gutter"),"data-cid":this.model.cid,"data-fullwidthvideo":this.model.get("fullwidthvideo"),"data-mutevideo":this.model.get("mutevideo"),"data-unloopvideo":this.model.get("unloopvideo")}},template:wp.template("builder_row_item"),events:{"click .themify_builder_option_row":"edit","click .themify_builder_style_row":"edit","click .themify_builder_delete_row":"delete",
"click .themify_builder_duplicate_row":"duplicate","click .themify_builder_grid_list li a":"_gridMenuClicked","click .themify_builder_grid_list_wrapper .grid_tabs li a":"_switchGridTabs","click .themify_builder_column_alignment li a":"_columnAlignmentMenuClicked","click .themify_builder_column_direction li a":"_columnDirectionMenuClicked","change .gutter_select":"_gutterChange","click .toggle_row":"toggleRow","click .themify_builder_toggle_row":"toggleRow","click .empty_holder_text":"showModPanel",
mouseout:"showAddBtn",mouseover:"showAddBtn"},initialize:function(){this.listenTo(this.model,"change:styling",this.renderInlineData)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.renderInlineData();if(_.isEmpty(this.model.get("cols")))e.Utils._addNewColumn({newclass:"col-full",component:"column",type:this.type},this.$el.find(".themify_builder_row_content"));else{var a=document.createDocumentFragment();_.each(this.model.get("cols"),function(b,c){b.component_name="column";
_.isObject(b.styling)&&(b.styling=e.Utils.removeEmptyFields(b.styling));var d=e.Views.init_column(b,this.type);a.appendChild(d.view.render().el)},this);this.$el.find(".themify_builder_row_content").append(a)}setTimeout(function(){e.Mixins.Builder._selectedGridMenu(this.$el)}.bind(this),100);var c={},d=this.model.get("col_tablet"),f=this.model.get("col_mobile"),g=this.$el.find(".themify_builder_row_content");c.desktop=this.model.get("desktop_dir");c.tablet=this.model.get("tablet_dir");c.mobile=this.model.get("mobile_dir");
d||(d="tablet-auto");f||(f="mobile-auto");c.desktop||(c.desktop="ltr");c.tablet||(c.tablet="ltr");c.mobile||(c.mobile="ltr");var h=this.$el;b.each(c,function(a,b){"ltr"!==b&&h.find(".themify_builder_grid_"+a+" .themify_builder_column_direction").first().find("li").removeClass("selected").children(".column-dir-"+b).parent().addClass("selected")});"visual"===e.mode?g.removeClass("desktop-col-direction-ltr desktop-col-direction-rtl tablet-col-direction-ltr tablet-col-direction-rtl mobile-col-direction-ltr mobile-col-direction-rtl").addClass("tfb_grid_classes desktop-col-direction-"+
c.desktop+" tablet-col-direction-"+c.tablet+" mobile-col-direction-"+c.mobile):g.addClass("direction-"+c.desktop);var c=this.$el.find(".themify_builder_grid_mobile ."+f).first(),k=this.$el.find(".themify_builder_grid_tablet ."+d).first(),l=parseInt(c.data("col")),t=parseInt(k.data("col"));c.closest("li").addClass("selected");k.closest("li").addClass("selected");if(2===l||3===l)f+=" mobile-"+(2===l?"2col":"3col");if(2===t||3===t)d+=" tablet-"+(2===t?"2col":"3col");g.addClass(this.model.get("gutter")+
" "+f+" "+d);return this},defaultRowValues:function(){var a=this,c=b(this.template(this.model.toJSON()));"col_align_top"!==a.model.get("column_alignment")&&c.find(".themify_builder_column_alignment > li").removeClass("selected").each(function(){b(this).find("a").data("alignment")===a.model.get("column_alignment")&&b(this).addClass("selected")});"gutter-default"!==a.model.get("gutter")&&c.find(".gutter_select option").each(function(){b(this).val()===a.model.get("gutter")&&(b(this).attr("selected",
""),setTimeout(function(){c.find(".gutter_select").trigger("change")}))});return c[0]},renderInlineData:function(){var a="",b="",d="",e="",g=this.model.get("styling");this.$el.find(".row-data-styling").attr("data-styling",JSON.stringify(g));_.isObject(g)&&(a=_.isEmpty(g.row_anchor)?"":"#"+g.row_anchor,(b=_.isEmpty(g.background_video)||"video"!==g.background_type?"":g.background_video)&&!_.isEmpty(g.background_video_options)&&(d=-1!==g.background_video_options.indexOf("mute")?"mute":"",e=-1!==g.background_video_options.indexOf("unloop")?
"unloop":""));this.$el.attr({"data-fullwidthvideo":b,"data-mutevideo":d,"data-unloopvideo":e});this.$el.find(".row-anchor-name").first().text(a);this.$el.find(".gutter_select").val(this.model.get("gutter"));this.$el.find('[data-alignment="'+this.model.get("column_alignment")+'"]').parent().addClass("selected").siblings().removeClass("selected")},edit:function(a){a.preventDefault();a.stopPropagation();this.model.set({styleClicked:b(a.currentTarget).hasClass("themify_builder_style_row")},{silent:!0});
e.activeModel=this.model;var c=this;e.vent.trigger("dom:observer:start",this.$el.closest("[data-postid]"),{cid:e.activeModel.cid,value:{styling:e.activeModel.get("styling")}});ThemifyBuilderCommon.highlightRow(this.$el);ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_row"},function(){e.Mixins.Builder.editComponent("row",c)})},"delete":function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(a=this.$el.closest("[data-postid]"),
e.vent.trigger("dom:observer:start",a),this.model.destroy(),e.vent.trigger("dom:observer:end",a),e.vent.trigger("dom:builder:change"))},duplicate:function(a){a.preventDefault();a.stopPropagation();a=e.Views.init_row(e.Utils._getRowSettings(this.$el,this.$el.index()),this.type);var b=this.$el.closest("[data-postid]");e.vent.trigger("dom:observer:start",b);a.view.render().$el.insertAfter(this.$el);a.view.trigger("component:duplicate");"visual"!==this.type&&(e.vent.trigger("dom:builder:change"),e.vent.trigger("dom:observer:end",
b))},_switchGridTabs:function(a){a.preventDefault();a.stopPropagation();if(!themifyBuilder.is_premium)return!1;var c=b(a.currentTarget),d=c.attr("href").replace("#","");if("module"===c.data("handle"))return!1;if("visual"!==e.mode){if(c.closest("li").hasClass("selected"))return!1;c.closest("ul").children("li.selected").removeClass("selected");c.closest("li").addClass("selected");c.closest(".grid_menu").find(".themify_builder_grid_tab").hide();c.closest(".grid_menu").find(".themify_builder_grid_tab.themify_builder_grid_"+
d).show().find(".themify_builder_column_direction li.selected a").trigger("click");b("body").removeClass("builder-active-breakpoint--desktop builder-active-breakpoint--tablet builder-active-breakpoint--tablet_landscape builder-active-breakpoint--mobile").addClass("builder-active-breakpoint--"+d)}else"tablet"===d&&(d+="-landscape"),b(".js--themify_builder_breakpoint_switcher.breakpoint-"+d).trigger("click"),setTimeout(function(){var a=c.closest(".themify_builder_row").data("cid"),g=c.closest(".themify_builder_content").data("postid"),
a="desktop"===d?b(".module_row_"+a,"#themify_builder_content-"+g):e.Frontend.responsiveFrame.$el.find("#themify_builder_content-"+g+" .module_row_"+a);b("html,body").animate({scrollTop:a.offset().top-b("#headerwrap.fixed-header").outerHeight(!0)-30},"fast")},1200)},_gridMenuClicked:function(a){a.preventDefault();a.stopPropagation();var c=this,d=b(a.currentTarget),f=d.data("grid"),g=d.data("handle"),h=!1,k=d.closest("[data-postid]"),l=d.data("type"),t="desktop"===l;e.vent.trigger("dom:observer:start",
k);d.closest(".themify_builder_grid_list").find(".selected").removeClass("selected");d.closest("li").addClass("selected");if("module"===g){if("-full"!==f[0]){var q=e.Views.init_subrow({cols:[{grid_class:"col-full"}]},this.type);var x=d.closest(".active_module"),v=x.clone();v.insertAfter(x);x.find(".grid_menu").remove();var m=q.view.render().$el.find(".themify_module_holder").append(x).end().insertAfter(v).find("."+d.attr("class").replace(" ",".")).closest("li").addClass("selected").end().end().find(".themify_builder_sub_row_content");
m.closest(".themify_builder_sub_row").find(".themify_builder_grid_"+l+":first .themify_builder_grid_list ."+l+f.join("-")).closest("li").addClass("selected");q=m.closest(".themify_builder_sub_row").find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li");e.Utils.hideResponsiveCols(q,d.data("col"));v.remove()}}else{h="sub_row"===g;var p=d.closest(".themify_builder_"+g);m=p.find(".themify_builder_"+g+"_content")}"visual"!==e.mode||
t||a.isTrigger||"module"===g||(v=m.closest(".themify_builder_content").data("postid"),b("#themify_builder_content-"+v).find(".module_"+g.replace("_","")+"_"+p.data("cid")+" .themify_builder_grid_"+l+":first .themify_builder_grid_list ."+l+f.join("-")).trigger("click"));if("module"!==g){var u=d.closest(".themify_builder_grid_list_wrapper");var w=t?d.data("col"):u.find(".themify_builder_grid_desktop li.selected a").data("col");if(w){if(!t){k=parseInt(d.data("col"));var r=l+f.join("-");if("visual"===
e.mode){a=r;if(2===k||3===k)a+=" "+l+"-"+(2===k?"2col":"3col");m.removeClass(l+"-2col "+l+"-3col tmp-mobile-auto "+p.attr("data-"+l)).addClass(a)}"tablet"===g&&e.Frontend.responsiveFrame.$el.find(".mobile-auto").removeClass("mobile-auto").addClass("tmp-mobile-auto");p.attr("data-"+l,r).data(l,r);return!1}a.isTrigger||(q=u.find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li"),e.Utils.hideResponsiveCols(q,w),"visual"===e.mode&&
(e.Utils.removeGridClass(m,"col-count"),m.removeClass("count-odd count-even").addClass("col-count-"+w+" count-"+(0===w%2?"even":"odd")),b.each(["tablet","mobile"],function(a,b){var c=u.find(".themify_builder_grid_"+b+" .themify_builder_grid_list li.selected"),d=0<c.length?u.find(".themify_builder_grid_"+b+" .themify_builder_grid_list li li").eq(w-1):!1;if(d&&"none"===c.css("display")&&"none"!==d.css("display")){c.removeClass("selected");d.addClass("selected");d=d.children("a");c=parseInt(d.data("col"));
d=d.data("grid");d=r=b+d.join("-");if(2===c||3===c)d+=" "+b+"-"+(2===c?"2col":"3col");m.removeClass(b+"-2col "+b+"-3col "+p.attr("data-"+b)).addClass(d);p.attr("data-"+b,r).data(b,r)}})))}}b.each(f,function(a,b){0<m.children(".themify_builder_col").eq(a).length?m.children(".themify_builder_col").eq(a).removeClass(e.Utils.clearClass).addClass("module_column col"+b):e.Utils._addNewColumn({newclass:(h?"sub_column module_column ":"")+"col"+b,component:h?"sub-column":"column",type:c.type},m)});f.length<
m.children().length&&m.children(".themify_builder_col").eq(f.length-1).nextAll().each(function(){b(this).find(".themify_module_holder").first().children().appendTo(b(this).prev().find(".themify_module_holder").first());b(this).remove()});g=m.children();g.removeClass("first last");"visual"===e.mode&&m.hasClass(l+"-col-direction-rtl")||"visual"!==e.mode&&m.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):(g.first().addClass("first"),g.last().addClass("last"));var n=
!1;h&&"-full"===f[0]&&(n=m.find(".active_module"),l=m.closest(".themify_builder_row"),n.insertAfter(d.closest(".themify_builder_sub_row")),d.closest(".themify_builder_sub_row").remove(),"visual"===e.mode&&"desktop"!==e.activeBreakPoint&&e.Mixins.Builder.initGridMenu(l));setTimeout(function(){var a=h&&n?n.find(".themify_builder_grid_list"):d.closest(".themify_builder_grid_list");"-full"===f[0]?(a.find("a:first").parent().addClass("selected"),a.nextAll(".themify_builder_column_alignment").find("a:first").trigger("click"),
a.nextAll(".gutter_select").val("gutter-default").trigger("change"),a.nextAll().hide()):a.nextAll().show()},100);e.Utils.columnDrag(m,!0);e.vent.trigger("dom:observer:end",k);e.vent.trigger("dom:builder:change")},_columnAlignmentMenuClicked:function(a){a.preventDefault();a.stopPropagation();var c=b(a.currentTarget),d=c.data("handle"),f=c.data("alignment");if("module"!==d&&(a.isTrigger||!c.closest("li").hasClass("selected"))){if(a.which){var g=c.closest("[data-postid]");e.vent.trigger("dom:observer:start",
g)}c.closest(".themify_builder_column_alignment").find(".selected").removeClass("selected");c.closest("li").addClass("selected");c=c.closest(".themify_builder_"+d);c.data("column-alignment",f);"visual"===this.type&&c.removeClass(themifyBuilder.columnAlignmentClass).addClass(f);a.which&&e.vent.trigger("dom:observer:end",g)}},_columnDirectionMenuClicked:function(a){a.preventDefault();a.stopPropagation();var c=b(a.currentTarget);var d=c.data("handle"),f=c.data("dir"),g=c.data("type"),h="module"===d?
!1:c.closest(".themify_builder_"+d).find(".themify_builder_"+d+"_content");if("module"!==d&&(a.isTrigger||f!==h.data(g+"-dir")&&!c.closest("li").hasClass("selected"))){if(a.which){var k=c.closest("[data-postid]");e.vent.trigger("dom:observer:start",k)}var l="";c.closest(".themify_builder_column_direction").find(".selected").removeClass("selected");c.closest("li").addClass("selected");h.removeClass("tablet-direction-selected mobile-direction-selected desktop-direction-selected").addClass(g+"-direction-selected").closest("[data-cid]").data(g+
"_dir",f);"visual"===e.mode?(h.removeClass(g+"-col-direction-ltr "+g+"-col-direction-rtl").addClass(g+"-col-direction-"+f),c=a.isTrigger&&"desktop"!==e.activeBreakPoint&&"desktop"===g,"desktop"===e.activeBreakPoint||a.isTrigger||(l=h.closest(".themify_builder_content").data("postid"),d="sub_row"===d?h.closest(".themify_builder_sub_row").data("cid"):h.closest(".themify_builder_row").data("cid"),b("#themify_builder_content-"+l).find('[data-cid="'+d+'"]').find(".themify_builder_grid_"+g+":first .themify_builder_column_direction  .column-dir-"+
f).trigger("click")),l="tablet_landscape"===e.activeBreakPoint?"tablet":e.activeBreakPoint):(h.removeClass("direction-rtl direction-ltr").addClass("direction-"+f),c=!0);if(c||g===l)g=h.children(".themify_builder_col"),h=g.first(),c=g.last(),g.removeClass("first last"),"rtl"===f?(h.addClass("last"),c.addClass("first")):(h.addClass("first"),c.addClass("last"));a.which&&e.vent.trigger("dom:observer:end",k)}},_gutterChange:function(a){a.stopPropagation();a=b(a.currentTarget);var c=a.data("handle");if("module"!==
c){var d=a.closest(".themify_builder_"+c);e.Utils.columnDrag(d.find(".themify_builder_"+c+"_content"),!1,d.data("gutter"),a.val());d.data("gutter",a.val()).find(".themify_builder_"+c+"_content").removeClass(themifyBuilder.gutterClass).addClass(a.val())}},toggleRow:function(a){a.preventDefault();a.stopPropagation();b(a.currentTarget).parents(".themify_builder_row").toggleClass("collapsed").find(".themify_builder_row_content").slideToggle()},showModPanel:function(a){a.preventDefault();a=this.$(a.target);
a.closest(".tb_plus_btn_popover").length||(a.children(".tb_plus_btn_popover").length&&b(".tb_plus_btn_popover").is(":visible")?(b(".tb_plus_btn_popover").hide(),a.css({zIndex:1})):(b(".empty_holder_text").hide(),a.append(b(".tb_plus_btn_popover")),"visual"==this.type?a.show().css({zIndex:99995}):a.show().css({zIndex:"auto"}),a=window.innerHeight-a[0].getBoundingClientRect().bottom,270>a&&b("html,body").animate({scrollTop:b(document).scrollTop()+(290-a)},500),b(".tb_plus_btn_popover").show()))},showAddBtn:function(a){a.preventDefault();
var c=b(a.target).closest(".themify_builder_row").children(".empty_holder_text");c.find(".tb_plus_btn_popover").length&&c.find(".tb_plus_btn_popover").is(":visible")||"mouseout"!=a.type?"mouseover"==a.type&&c.show():c.css({zIndex:1}).hide()}});e.Views.Builder=Backbone.View.extend({type:"default",events:{"click .tb-import-layout-button":"importLayoutButton"},initialize:function(a){_.extend(this,_.pick(a,"type"));e.vent.on("dom:builder:change",this.tempEvents.bind(this))},render:function(){var a=document.createDocumentFragment();
this.collection.each(function(b){_.isObject(b.attributes)&&_.isObject(b.attributes.styling)&&(b.attributes.styling=e.Utils.removeEmptyFields(b.attributes.styling));b=e.Views.init_row(b,this.type);a.appendChild(b.view.render().el)},this);this.el.appendChild(a);this.addElementClasses();e.Utils.columnDrag(null,!1);e.vent.trigger("dom:builder:change");this.insertLayoutButton();return this},addElementClasses:function(){var a=this.$el.data("postid");this.$el.find(".themify_builder_row").addClass("themify_builder_"+
a+"_row");this.$el.find(".themify_builder_col:not(.sub_column)").addClass("module_column tb_"+a+"_column")},tempEvents:function(){this.deleteEmptyModule();this.newRowAvailable();this.moduleEvents()},insertLayoutButton:function(){2>this.$(".module_row ").length&&this.$el.append('<a href="#" class="tb-import-layout-button'+(themifyBuilder.is_premium?"":" themify_builder_lite")+'">'+themifyBuilderCommon.text_import_layout_button+"</a>")},importLayoutButton:function(a){a.preventDefault();if(!themifyBuilder.is_premium)return!1;
e.Views.Toolbar.prototype.load_layout(a)}});e.Mixins.Common={_autoSelectInputField:function(a){a.trigger("focus").trigger("select")},highlightModuleBack:function(a){b(".active_module").removeClass("current_selected_module");a.addClass("current_selected_module")},moduleOptionsBinding:function(){var a=function(a,c,e){if(c){var d=!1;""==e&&"undefined"!==typeof c.empty?d=c.empty:""!=e&&"undefined"!==typeof c[e]?d=c[e]:""!=e&&"undefined"!==typeof c.not_empty&&(d=c.not_empty);d&&("undefined"!==typeof d.show&&
b.each(d.show,function(c,d){var e=a.closest(".themify_builder_row_content");e.length?e.find("."+d).removeClass("conditional-input").children().show():b("."+d).removeClass("conditional-input").children().show()}),"undefined"!==typeof d.hide&&b.each(d.hide,function(c,d){var e=a.closest(".themify_builder_row_content");0<e.length?e.find("."+d).addClass("conditional-input").children().hide():b("."+d).addClass("conditional-input").children().hide()}))}},c=b("#tfb_module_settings");b("body").on("change",
"input[data-binding], textarea[data-binding], select[data-binding]",c,function(){a(b(this),b(this).data("binding"),b(this).val())});b("input[data-binding], textarea[data-binding], select[data-binding]",c).trigger("change");b(c).on("click",".tfb_lb_option.themify-layout-icon[data-binding] a",function(){a(b(this),b(this).parent().data("binding"),b(this).attr("id"))});b(".tfb_lb_option.themify-layout-icon a.selected",c).trigger("click")},applyAll_init:function(){var a=this;b(".style_apply_all").each(function(){var c=
b(this).val(),d=b(this).closest(".themify_builder_field").prevUntil("h4"),f=d.last(),g=f.find('input[type="text"]').not(".colordisplay"),h=f.find("select"),k="border"===c?'[name="border_top_color"], [name="border_top_width"], [name="border_top_style"], [name="border_right_color"], [name="border_right_width"], [name="border_right_style"], [name="border_bottom_color"], [name="border_bottom_width"], [name="border_bottom_style"], [name="border_left_color"], [name="border_left_width"], [name="border_left_style"]':
'[name="'+c+'_top"], [name="'+c+'_right"], [name="'+c+'_bottom"], [name="'+c+'_left"]',l=!0,t=function(g){if(d.first().next(".themify_builder_field").find(".style_apply_all").is(":checked")){var h=b(this).val(),k=!1,l=b(this).is("select");d.not(":last").each(function(){l?(k=b(this).find("select option").prop("selected",!1).filter('[value="'+h+'"]'),k.prop("selected",!0),"border"!==c&&k.trigger("change")):(k=b(this).find('input[type="text"].tfb_lb_option'),k.val(h),"border"!==c&&k.trigger("keyup"))});
k&&"border"===c&&"visual"===a.type&&(e.liveStylingInstance.setApplyBorder(l?k.closest("select").prop("name"):k.prop("name"),h,l?"style":"width"),l?f.find('input[type="text"].colordisplay').trigger("blur"):(g=f.find(".colordisplay, .style_border").map(function(){return this.value||null}).get(),_.isEmpty(g)?e.liveStylingInstance.setApplyBorder(f.find("select").prop("name"),"","style"):f.find("select").trigger("change")))}};b(this).is(":checked")?(d.not(":last").hide(),f.children(".themify_builder_input").css("color",
"#FFF")):(d.find(k).each(function(){if(b(this).val()&&"solid"!==b(this).val())return l=!1}),l&&(b(this).prop("checked",!0),d.not(":last").hide(),f.children(".themify_builder_input").css("color","#FFF")));g.on("keyup",_.debounce(t,300));h.on("change",t)})},getShortcodePreview:function(a,c){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tfb_load_shortcode_preview",tfb_load_nonce:themifyBuilder.tfb_load_nonce,shortcode:c},success:function(b){b&&a.after(b)}})},rowOptionBuilder:function(){b(".themify_builder_row_opt_builder_wrap").sortable({items:".themify_builder_row",
handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",start:function(a,c){"undefined"!==typeof tinyMCE&&b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id"),c=tinymce.get(a).getContent();b(this).data("content",c);tinyMCE.execCommand("mceRemoveEditor",!1,a)})},stop:function(a,c){"undefined"!==typeof tinyMCE&&b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");
tinyMCE.execCommand("mceAddEditor",!1,a);tinymce.get(a).setContent(b(this).data("content"))})},sort:function(a,c){var d=c.item.height();b(".themify_builder_row_opt_builder_wrap .themify_builder_ui_state_highlight").height(d)}})}};e.Mixins.Builder={builderContainer:document.querySelector(".themify_builder_editor_wrapper"),moduleEvents:function(){var a=this;this.$el.find(".row_menu .themify_builder_dropdown, .module_menu .themify_builder_dropdown").hide();var c=!1,d={placeholder:"themify_builder_ui_state_highlight",
items:".active_module, .themify_builder_sub_row",connectWith:".themify_module_holder",cursor:"move",revert:100,tolerance:"pointer",cursorAt:{top:20,left:110},beforeStart:function(d,f){e.vent.trigger("dom:observer:start",f.item.closest("[data-postid]"));"visual"===a.type&&(f.item.css("height",40),c=!0,b(this).sortable("refresh"))},sort:function(c,d){b(".themify_module_holder .themify_builder_ui_state_highlight").height(35);"visual"===a.type?(b(".themify_module_holder .themify_builder_sortable_helper").height(40).width(220),
b("#themify_builder_module_panel").hasClass("slide_builder_module_state_down")||(b("#themify_builder_module_panel").addClass("slide_builder_module_state_down"),e.Frontend.slidePanelOpen=!1,b("#themify_builder_module_panel").find(".slide_builder_module_panel_wrapper").slideUp())):d.item.css("width",220)},stop:function(d,f){if(f.item.hasClass("active_module")||f.item.hasClass("themify_builder_sub_row"))c&&(f.item.css("height",""),c=!1),f.item.hasClass("themify_builder_sub_row")&&f.item.parents(".themify_builder_sub_row").length&&
(f.item.find(".active_module").clone().insertAfter(f.item),f.item.remove()),0<b(".themify_module_holder .themify_builder_sortable_helper").length&&b(".themify_module_holder .themify_builder_sortable_helper").remove(),e.vent.trigger("dom:builder:change"),e.vent.trigger("dom:observer:end",f.item.closest("[data-postid]"));else{var g=e.Views.init_module({mod_name:f.item.data("module-slug")},a.type),h=g.view.render().$el;f.item.replaceWith(h);g.view.trigger("edit",null,!0);g.view.trigger("custom:preview:init");
g.view.$el.addClass("tb_module_state_unsaved")}0<b(".themify_module_holder .themify_builder_ui_state_highlight").length&&b(".themify_module_holder .themify_builder_ui_state_highlight").remove()}};"visual"===a.type&&(d.helper=function(){return b('<div class="themify_builder_sortable_helper"/>')},d.handle=".themify_builder_module_front_overlay, .themify_builder_sub_row_top",d.create=function(a,c){b("body").css("overflow-x","inherit")});this.$(".themify_module_holder").sortable(d);var f,g,h,k=!1,d={items:".themify_builder_row",
handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",containment:"parent",tolerance:"pointer",cursor:"move",beforeStart:function(c,d){e.vent.trigger("dom:observer:start",d.item.closest("[data-postid]"));"visual"!==a.type||d.item.hasClass("collapsed")||(d.item.addClass("collapsed").find(".themify_builder_row_content").first().hide(),k=!0,b(this).sortable("refresh"))},start:function(a,b){f=b.placeholder.index();h=b.item.outerHeight(!0);b.item.nextAll("div:not(.themify_builder_ui_state_highlight)").css({transform:"translateY("+
h+"px)"});b.placeholder.css({height:0,padding:0})},change:function(a,c){g=c.placeholder.index();if(f>g){var d=b(".themify_builder_row").slice(g,b(".themify_builder_row").length);d.not(".ui-sortable-helper").each(function(){b(this).css({transform:"translateY("+h+"px)"})})}else f<g&&(d=b(".themify_builder_row").slice(f,g),d.not(".ui-sortable-helper").each(function(){b(this).css({transform:"translateY(0px)"})}));f=g},sort:function(c,d){if("visual"===a.type)b(".themify_builder_ui_state_highlight").height(35),
b(".themify_builder_sortable_helper").height(35);else{var e=d.item.height();b(".themify_builder_row_panel .themify_builder_ui_state_highlight").height(e)}},update:function(b,c){"visual"===a.type&&k&&(c.item.removeClass("collapsed").find(".themify_builder_row_content").first().show(),k=!1);e.vent.trigger("dom:observer:end",c.item.closest("[data-postid]"))},create:function(c,d){"visual"===a.type&&b("body").css("overflow-x","inherit")},stop:function(c,d){b(".ui-sortable-handle, .themify_builder_row").css({transform:""});
b(".tb_plus_btn_popover").hide().closest(".empty_holder_text").trigger("mouseout");var e=themifybuilderapp.toolbar;"predesigned-rows"==d.item.data("type")&&(d.item.empty().removeClass("tb_module_dragging_helper").addClass("predesigned_rows_temp_holder"),e.put_row_template(d.item));"visual"===a.type&&k&&(d.item.removeClass("collapsed").find(".themify_builder_row_content").first().show(),k=!1)}};"visual"===a.type&&(d.helper=function(){return b('<div class="themify_builder_sortable_helper"/>')});this.$el.sortable(d);
this.$el.find(".themify_builder_row_content, .themify_builder_sub_row_content").each(function(){var a=b(this);1<a.children(".themify_builder_col").length&&a.sortable({items:"> .themify_builder_col",handle:"> .themify_builder_column_action .themify_builder_column_dragger",axis:"x",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart:function(a,b){e.vent.trigger("dom:observer:start",b.item.closest("[data-postid]"))},sort:function(a,c){b(".themify_builder_ui_state_highlight").width(c.item.width())},
stop:function(b,c){a.children().removeClass("first last");var d="tablet_landscape"===e.activeBreakPoint?"tablet":e.activeBreakPoint;"visual"===e.mode&&a.hasClass(d+"-col-direction-rtl")||"visual"!==e.mode&&a.hasClass("direction-rtl")?(a.children().last().addClass("first"),a.children().first().addClass("last")):(a.children().first().addClass("first"),a.children().last().addClass("last"));e.Utils.columnDrag(a,!1);e.vent.trigger("dom:observer:end",c.item.closest("[data-postid]"))}})});this.initGridMenu()},
initGridMenu:function(a){a||(a=this.$el);var c=wp.template("builder_grid_menu")({});a.find(".themify_builder_row_content").each(function(){b(this).children().each(function(){b(this).find(".themify_module_holder").first().children(".active_module").each(function(){if(0===b(this).find(".grid_menu").length){var a=b(c);a.find(".grid-layout--full").closest("li").addClass("selected");b(this).append(a)}})})})},editComponent:function(a,c){var d="row"===a,f=c.model.get("styling")||{},g=d?"#tfb_row_settings":
"sub-row"===a?"#tfb_subrow_settings":"#tfb_column_settings";if("desktop"!==e.activeBreakPoint){var h=b((d?"#themify_builder_row_fields_styling":g)+" .tfb_lb_option").map(function(){return b(this).attr("id")}).get();var k=f.background_type;f=_.omit(f,h);!_.isUndefined(f["breakpoint_"+e.activeBreakPoint])&&_.isObject(f["breakpoint_"+e.activeBreakPoint])&&(f=_.extend(f,f["breakpoint_"+e.activeBreakPoint]))}"visual"===c.type&&e.liveStylingInstance.init(c.$el,f);f&&("undefined"!==typeof f.background_slider&&
c.getShortcodePreview(b("#background_slider"),f.background_slider),b.each(f,function(a,c){b(g).find("#"+a).val(c)}),b(g).find('.tf-radio-input-container [type="radio"]').each(function(){var a=b(this).prop("name");"undefined"!==typeof f[a]&&b(this).val()===f[a]&&b(this).prop("checked",!0)}));b(g).find(".themify-builder-uploader-input").each(function(){var a=b(this).val(),c=b("<img/>",{src:a,width:50,height:50});a?b(this).parent().find(".img-placeholder").empty().html(c):b(this).parent().find(".thumb_preview").hide()});
b(".themify-gradient").each(function(){var a=b(this).prop("name");f=b.extend({$key:""},f);e.Utils.createGradientPicker(b(this),f[a])});d&&b(g).find(".themify_builder_row_js_wrapper").each(function(){var a=b(this),c=a.attr("id"),d=f?f[c]:!1;e.cache.repeaterElements[c]=a.find(".tb_repeatable_field").first().clone();if(d){c=0;0<d.length&&(c=d.length-1);for(var g=0;g<c;g++)a.parent().find(".add_new a").first().trigger("click");a.find(".tb_repeatable_field").each(function(a){b(this).find(".tfb_lb_option_child").each(function(c){c=
b(this);var e=c.hasClass("tfb_lb_wp_editor")?c.attr("name"):c.data("input-id");e||(e=c.attr("id"));e=d[a][""+e+""];if(c.hasClass("themify-builder-uploader-input")){var f=b("<img/>",{src:e,width:50,height:50});e?(c.val(e),c.parent().find(".img-placeholder").empty().html(f).parent().show()):c.parent().find(".thumb_preview").hide()}else c.is("input, textarea, select")&&c.val(e)})})}e.Views.init_control("repeater",{el:a})});e.Utils.setColorPicker();""!==b("#background_video").val()&&0===b("#background_type input:checked").length?
b("#background_type_video").trigger("click"):0===b("#background_type input:checked").length&&b("#background_type_image").trigger("click");b(".tf-option-checkbox-enable input:checked").trigger("click");e.Utils.builderPlupload("normal");b(".themify-checkbox").each(function(){var a=b(this).attr("id");b(this).find(".tf-checkbox").prop("checked",!1);f&&f[a]&&(f[a]="string"===typeof f[a]?[f[a]]:f[a],b.each(f[a],function(a,c){b('.tf-checkbox[value="'+c+'"]').prop("checked",!0)}))});b("body").trigger("editing_"+
a.replace("-","_")+"_option",[f]);d&&c.rowOptionBuilder();c.applyAll_init();ThemifyBuilderCommon.fontPreview(b("#themify_builder_lightbox_container"),f);d&&c.model.get("styleClicked")&&b('a[href="#themify_builder_row_fields_styling"]').trigger("click");"desktop"!==e.activeBreakPoint&&(b(".responsive-na").hide(),-1!==b.inArray(k,["video","slider"])&&b.each(["background_repeat","background_position","background_image"],function(a,c){if("video"===k&&"background_image"===c)return!0;b("#"+c).closest(".themify_builder_field").hide()}));
"visual"===c.type&&(ThemifyBuilderCommon.Lightbox.rememberRow(c),e.liveStylingInstance.addStyleDate(c.model.get("elType"),themifyBuilder.element_style_rules[c.model.get("elType")]),e.styleSheet.rememberRules())},newRowAvailable:function(){var a=this.$el.children(".themify_builder_row");a.each(function(){if(!(0<b(this).find(".active_module").length)){var c=!0,d=null;b(this).find(".column-data-styling").each(function(){c&&(d=b.parseJSON(b(this).attr("data-styling")),"array"===typeof d&&0<d.length||
!b.isEmptyObject(d))&&(c=!1)});d=b.parseJSON(b(this).find(".row-data-styling").attr("data-styling"));if(c&&("string"===typeof d||b.isEmptyObject(d))&&1<a.length&&b(this).index()+1<a.length){var f=b(this).find("[data-cid]").map(function(){return b(this).data("cid")}).get();f.push(b(this).data("cid"));console.log(f,"removeCids");_.each(f,function(a,b){var c=e.Models.Registry.lookup(a);c&&c.destroy()})}}});(0<this.$el.children(".themify_builder_row").last().find(".active_module").length||0===this.$el.children(".themify_builder_row").length)&&
e.Views.init_row({cols:[{grid_class:"col-full first last"}]},this.type).view.render().$el.appendTo(this.$el)},refreshRows:function(){ThemifyBuilderCommon.showLoader("show");e.bootstrap(function(){ThemifyBuilderCommon.showLoader("spinhide");e.vent.trigger("dom:builder:change")})},_selectedGridMenu:function(a){a=a||document;b(".grid_menu",a).each(function(){var a=b(this).data("handle"),d=[];if("module"!==a){a=b(this).closest(".themify_builder_"+a).find(".themify_builder_"+a+"_content");a.children().each(function(){d.push(e.Utils._getColClass(b(this).prop("class").split(" ")))});
var f=b(this).find(".themify_builder_grid_desktop .grid-layout-"+d.join("-")),g=f.data("col");f.closest("li").addClass("selected");var h=b(this).find(".themify_builder_grid_desktop .themify_builder_grid_list"),k=f.data("grid");k&&"-full"===k[0]?(h.nextAll(".themify_builder_column_alignment").find("a:first").trigger("click"),h.nextAll(".gutter_select").val("gutter-default").trigger("change"),h.nextAll().hide()):h.nextAll().show();h=b(this).find(".themify_builder_grid_tablet .themify_builder_grid_list li li,.themify_builder_grid_mobile .themify_builder_grid_list li li");
e.Utils.hideResponsiveCols(h,g);f.data("col")&&a.addClass("col-count-"+g+" count-"+(0===g%2?"even":"odd"))}})},makeEqual:function(a,c){a.each(function(){var a=0;b(this).find(c).children().each(function(){var c=b(this).find(".themify_module_holder").first();c.css("min-height","");c.height()>a&&(a=c.height())});b(this).find(c).children().each(function(){b(this).find(".themify_module_holder").first().css("min-height",a+"px")})})},deleteEmptyModule:function(){this.$el.find(".active_module.tb_module_state_unsaved").each(function(){var a=
e.Models.Registry.lookup(b(this).data("cid"));a&&a.destroy()})},toJSON:function(){var a={};this.$el.children(".themify_builder_row").each(function(c){a[c]=e.Utils._getRowSettings(b(this),c)});return a}};e.Forms={Validators:{},bindEvents:function(){var a=b("body");_.isNull(e.Utils.tfb_hidden_editor_object)&&(e.Utils.tfb_hidden_editor_object=tinyMCEPreInit.mceInit.tfb_lb_hidden_editor);if(b.fn.ThemifyGradient)a.on("change",".tf-image-gradient-field .tf-radio-input-container input",function(){var a=
b(this).val(),d=b(this).closest(".tf-image-gradient-field"),e=d.find(".themify-gradient-field").hide(),d=d.find(".themify-image-field").hide();"image"===a&&d.show();"gradient"===a&&e.show()});a.on("click",this.clickCheck).on("click","#tfb_row_settings .add_new a",this.rowOptAddRow).on("click","#tfb_module_settings .add_new a",this.moduleOptAddRow).on("click",".js-builder-restore-revision-btn",ThemifyBuilderCommon.restoreRevision).on("click",".js-builder-delete-revision-btn",ThemifyBuilderCommon.deleteRevision).on("click",
"#builder_submit_import_form",this.builderImportSubmit).on("click",".layout_preview img",this.templateSelected).on("click","#builder_submit_layout_form",this.saveAsLayout).on("click",".style_apply_all",this.applyAll_events).on("click","#builder_submit_import_component_form",this.importRowModBuilderFormSave);this.moduleActions()},clickCheck:function(a){b(a.target).closest(".tb_plus_btn_popover").length||b(a.target).closest(".empty_holder_text").length||b(".tb_plus_btn_popover").is(":visible")&&b(".tb_plus_btn_popover").hide().appendTo("body")},
moduleSave:function(a){a.preventDefault();if(e.Forms.isValidate(b("#tfb_module_settings"))){var c={},d=e.activeModel.get("mod_settings");a=b(".current_selected_module").closest("[data-postid]");b("#tfb_module_settings .tfb_lb_option").each(function(){var a=b(this).attr("id");if(b(this).hasClass("tfb_lb_wp_editor")&&!b(this).hasClass("builder-field"))var d="undefined"!==typeof tinyMCE?!1===tinyMCE.get(a).hidden?tinyMCE.get(a).getContent():switchEditors.wpautop(tinymce.DOM.get(a).value):b(this).val();
else if(b(this).hasClass("themify-checkbox")){var f=[];b(this).find(".tf-checkbox:checked").each(function(a){f.push(b(this).val())});d=0<f.length?f.join("|"):null}else if(b(this).hasClass("themify-layout-icon"))d=0<b(this).find(".selected").length?b(this).find(".selected").attr("id"):b(this).children().first().attr("id");else if(b(this).hasClass("themify-option-query-cat")){var g=b(this).parent();d=g.find(".query_category_single");g=g.find(".query_category_multiple");d=g.val()?g.val()+"|multiple":
d.val()+"|single"}else b(this).hasClass("themify_builder_row_js_wrapper")?d=e.Utils.getRepeaterValues(b(this)):b(this).hasClass("tf-radio-input-container")?d=b(this).find('input[name="'+a+'"]:checked').val():b(this).hasClass("module-widget-form-container")?d=b(this).find(":input").themifySerializeObject():b(this).is("select, input, textarea")&&(d=b(this).val());d&&(d!=b(this).data("default")||b(this).hasClass("themify-checkbox")||"solid"===d)&&(c[a]=d)});if("desktop"!==e.activeBreakPoint){var f=b("#themify_builder_options_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get(),
g=_.pick(c,f),c=_.omit(c,f),c=_.extend(c,_.pick(d,f));c["breakpoint_"+e.activeBreakPoint]=g;_.each(_.omit(themifyBuilder.breakpoints,e.activeBreakPoint),function(a,b){_.isUndefined(d["breakpoint_"+b])||(c["breakpoint_"+b]=d["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(d["breakpoint_"+b])||(c["breakpoint_"+b]=d["breakpoint_"+b])});e.activeModel.set({mod_settings:{}},{silent:!0});e.activeModel.set({mod_settings:e.Utils.removeEmptyFields(c)});e.activeModel.trigger("custom:element:updatestate");
ThemifyBuilderCommon.Lightbox.close();e.vent.trigger("dom:observer:end",a,{cid:e.activeModel.cid,value:{mod_settings:e.activeModel.get("mod_settings")}});0<b(".mce-inline-toolbar-grp:visible").length&&b(".mce-inline-toolbar-grp:visible").hide();0<b(".tb-import-layout-button").length&&b(".tb-import-layout-button").remove()}},rowSaving:function(a){a.preventDefault();var c=b("#tfb_row_settings").themifySerializeObject(),d=e.activeModel.get("styling")||{};a={};var f=b(".current_selected_row").closest("[data-postid]");
b("#tfb_row_settings").find(".themify_builder_row_js_wrapper").each(function(){var a=b(this).attr("id"),d=e.Utils.getRepeaterValues(b(this));d&&(c[a]=d)});if("desktop"!==e.activeBreakPoint){var g=b("#themify_builder_row_fields_styling .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=_.pick(c,g);c=_.omit(c,g);c=_.extend(c,_.pick(d,g));c["breakpoint_"+e.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,e.activeBreakPoint),function(a,b){_.isUndefined(d["breakpoint_"+b])||
(c["breakpoint_"+b]=d["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(d["breakpoint_"+b])||(c["breakpoint_"+b]=d["breakpoint_"+b])});e.activeModel.set({styling:{}},{silent:!0});e.activeModel.set("styling",e.Utils.removeEmptyFields(c));ThemifyBuilderCommon.Lightbox.close();e.vent.trigger("dom:observer:end",f,{cid:e.activeModel.cid,value:{styling:e.activeModel.get("styling")}})},subRowSaving:function(a){a.preventDefault();var c=e.activeModel.get("styling")||{},
d=b("#tfb_subrow_settings").themifySerializeObject();a={};var f=b(".current_selected_sub_row").closest("[data-postid]");if("desktop"!==e.activeBreakPoint){var g=b("#tfb_subrow_settings .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=d;d=_.omit(d,g);d=_.extend(d,_.pick(c,g));d["breakpoint_"+e.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,e.activeBreakPoint),function(a,b){_.isUndefined(c["breakpoint_"+b])||(d["breakpoint_"+b]=c["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,
function(a,b){_.isUndefined(c["breakpoint_"+b])||(d["breakpoint_"+b]=c["breakpoint_"+b])});e.activeModel.set({styling:{}},{silent:!0});e.activeModel.set("styling",e.Utils.removeEmptyFields(d));ThemifyBuilderCommon.Lightbox.close();e.vent.trigger("dom:observer:end",f,{cid:e.activeModel.cid,value:{styling:e.activeModel.get("styling")}})},columnSaving:function(a){a.preventDefault();var c=e.activeModel.get("styling")||{},d=b("#tfb_column_settings").themifySerializeObject();a={};var f=b(".current_selected_column").closest("[data-postid]");
if("desktop"!==e.activeBreakPoint){var g=b("#tfb_column_settings .tfb_lb_option").map(function(){return b(this).attr("id")}).get();a=d;d=_.omit(d,g);d=_.extend(d,_.pick(c,g));d["breakpoint_"+e.activeBreakPoint]=a;_.each(_.omit(themifyBuilder.breakpoints,e.activeBreakPoint),function(a,b){_.isUndefined(c["breakpoint_"+b])||(d["breakpoint_"+b]=c["breakpoint_"+b])})}else _.each(themifyBuilder.breakpoints,function(a,b){_.isUndefined(c["breakpoint_"+b])||(d["breakpoint_"+b]=c["breakpoint_"+b])});e.activeModel.set("styling",
e.Utils.removeEmptyFields(d));ThemifyBuilderCommon.Lightbox.close();e.vent.trigger("dom:observer:end",f,{cid:e.activeModel.cid,value:{styling:e.activeModel.get("styling")}})},rowOptAddRow:function(a){var c=b(this).parent().prev(),d=e.cache.repeaterElements[c.attr("id")].clone(),f=b(".themify_builder_row_js_wrapper").find(".themify_builder_row:visible").length+1,g=f+Math.floor(9*Math.random());d.removeClass("collapsed").find(".themify_builder_row_content").show();d.find(".themify-builder-radio-dnd").each(function(a){var c=
b(this).attr("name");b(this).attr({name:c+"_"+f,id:c+"_"+f+"_"+a}).not(":checked").prop("checked",!1).next("label").attr("for",c+"_"+f+"_"+a)});d.find(".themify-layout-icon a").removeClass("selected");d.find(".thumb_preview").each(function(){b(this).find(".img-placeholder").html("").parent().hide()});d.find('input[type="text"], textarea').each(function(){b(this).val("")});d.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var c=b(this).parents(".wp-editor-wrap").parent(),d=b(this).prop("id"),
e=b(this).prop("name"),f=d+"_"+ThemifyBuilderCommon.randNumber(),d=c.html().replace(new RegExp(d,"g"),f),f=a.which?"newEditor":"";c.html(d).find(".tfb_lb_wp_editor").prop("name",e).addClass(f)});d.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find('input[type="button"]').attr("id","pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});d.find(".builderColorSelectInput").each(function(){var a=
b(this),c=a.clone().val(""),d=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");d.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c);e.Utils.setColorPicker(d)});b(d).appendTo(c).show();a.which&&(b("#tfb_row_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){e.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")}),
e.Utils.builderPlupload("new_elemn"));a.preventDefault()},moduleOptAddRow:function(a){var c=b(this).parent().prev(),d=e.cache.repeaterElements[c.attr("id")].clone(),f=b(".themify_builder_row_js_wrapper").find(".tb_repeatable_field").length+1,g=f+Math.floor(9*Math.random());d.removeClass("collapsed").find(".themify_builder_row_content").show();d.find(".themify-builder-radio-dnd").each(function(a){var c=b(this).attr("name");b(this).prop({name:c+"_"+f,id:c+"_"+f+"_"+a,checked:!1}).next("label").attr("for",
c+"_"+f+"_"+a);if(b(this).is("[data-checked]")){var d=b(this);b(this).prop("checked",!0);setTimeout(function(){d.trigger("change")},100)}});d.find("[data-binding]").each(function(){var a=b(this).data("binding");try{var c="."+a.empty.hide.join(", .");d.find(c).children().hide()}catch(l){}});d.find(".themify-layout-icon a").removeClass("selected");d.find(".thumb_preview").each(function(){b(this).find(".img-placeholder").html("").parent().hide()});d.find("input[type=text], textarea").each(function(){b(this).val("")});
d.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var c=b(this).parents(".wp-editor-wrap").parent(),d=b(this).prop("id"),e=b(this).prop("name"),f=d+"_"+ThemifyBuilderCommon.randNumber(),d=c.html().replace(new RegExp(d,"g"),f),f=a.which?"newEditor":"";c.html(d).find(".tfb_lb_wp_editor").prop("name",e).addClass(f)});d.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find("input[type=button]").attr("id",
"pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});d.find(".builderColorSelectInput").each(function(){var a=b(this),c=a.clone().val(""),d=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");d.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c);e.Utils.setColorPicker(d)});d.find(".tfb_lb_option_child").each(function(){b(this).data("control-binding")&&b(this).data("control-type")&&
e.Views.init_control(b(this).data("control-type"),{el:b(this),binding_type:b(this).data("control-binding")})});b(d).appendTo(c).show();a.which&&(b("#tfb_module_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){e.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")}),e.Utils.builderPlupload("new_elemn"));a.preventDefault()},builderImportSubmit:function(a){a.preventDefault();var c=b(this);ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,
function(a){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",nonce:themifyBuilder.tfb_load_nonce,data:c.closest("form").serialize(),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.Lightbox.close();ThemifyBuilderCommon.showLoader("spinhide");window.location.reload()}})},{buttons:{no:{label:"Replace Existing Builder"},yes:{label:"Append Existing Builder"}}})},
templateSelected:function(a){a.preventDefault();var c=b(this).closest(".layout_preview");ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(a){var d={type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"no"===a?"tfb_set_layout":"tfb_append_layout",nonce:themifyBuilder.tfb_load_nonce,layout_slug:c.data("slug"),current_builder_id:themifyBuilder.post_ID,layout_group:c.data("group")},success:function(a){ThemifyBuilderCommon.Lightbox.close();
if("success"==a.status)if("visual"===e.mode)window.location.hash="#builder_active",window.location.reload();else{var c=wp.autosave.getPostData();e.isPostSave=!0;!_.isUndefined(c.auto_draft)&&c.auto_draft&&(a=new e.Collections.Rows(a.builder_data),e.Instances.Builder[0]=new e.Views.Builder({el:"#themify_builder_row_wrapper",collection:a}),e.Instances.Builder[0].render());b(b("#save-post").length?"#save-post":"#publish").trigger("click")}else alert(a.msg)}};if("pre-designed"==c.data("group")){ThemifyBuilderCommon.showLoader("show");
var g="https://themify.me/themify-layouts/"+c.data("slug")+".txt";b.get(g,null,null,"text").done(function(a){d.data.builder_data=a;b.ajax(d)}).fail(function(a,b,c){ThemifyBuilderCommon.LiteLightbox.alert("There was an error in loading layout, please try again later, or you can download this file: ("+g+") and then import manually (http://themify.me/docs/builder#import-export).")}).always(function(){ThemifyBuilderCommon.showLoader()})}else b.ajax(d)},{buttons:{no:{label:"Replace Existing Layout"},yes:{label:"Append Existing Layout"}}})},
saveAsLayout:function(a){a.preventDefault();b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tfb_save_custom_layout",nonce:themifyBuilder.tfb_load_nonce,form_data:b("#tfb_save_layout_form").serialize()},success:function(a){"success"===a.status?ThemifyBuilderCommon.Lightbox.close():alert(a.msg)}})},applyAll_events:function(a){a=b(this);var c=a.closest(".themify_builder_field").prevUntil("h4");if(a.prop("checked")){var d=!0;c.not(":last").slideUp(function(){d&&(c.last().find('input[type="text"], select').each(function(){var a=
"SELECT"===b(this).prop("tagName")?"change":"keyup";b(this).trigger(a)}),d=!1)});c.last().children(".themify_builder_input").css("color","#FFF")}else c.slideDown(),c.last().children(".themify_builder_input").css("color","")},importRowModBuilderFormSave:function(a){a.preventDefault();var c=b("#tfb_imp_component_form");a=c.find("input[name='component']").val();var d=b('[data-cid="'+e.activeModel.cid+'"]').closest("[data-postid]");e.vent.trigger("dom:observer:start",d,{cid:e.activeModel.cid,value:e.activeModel.toJSON()});
c=c.find("#tfb_imp_"+a.replace("-","_")+"_data_field");c=JSON.parse(c.val());if(c.hasOwnProperty("component_name")&&c.component_name===a){if("column"===a||"sub-column"===a){var f=b(".current_selected_column"),g=f.closest("column"===a?".themify_builder_row":".themify_builder_sub_row").index(),h=f.index();c.column_order=h;c.grid_class=f.prop("class").replace("themify_builder_col","");"column"===a?c.row_order=g:(c.sub_row_order=g,c.row_order=f.closest(".themify_builder_row").index(),c.col_order=f.parents(".themify_builder_col").index())}ThemifyBuilderCommon.Lightbox.close();
e.activeModel.setData(c);e.vent.trigger("dom:builder:change");"visual"!==e.mode&&e.vent.trigger("dom:observer:end",d,{cid:e.activeModel.cid,value:e.activeModel.toJSON()})}else ThemifyBuilderCommon.alertWrongPaste()},moduleActions:function(){var a=b("body");a.on("editing_module_option",function(c,d){function e(){if(0!==g.length){var a=g.val(),c=g.find(":selected").data("idbase");b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"html",data:{action:"module_widget_get_form",tfb_load_nonce:themifyBuilder.tfb_load_nonce,
load_class:a,id_base:c,widget_instance:d.instance_widget},success:function(a){a=b(a);b(".module-widget-form-placeholder").html(a);b("#themify_builder_lightbox_container").each(function(){b(this).find("#instance_widget").find("select").wrap('<div class="selectwrapper"></div>')});b(".selectwrapper").click(function(){b(this).toggleClass("clicked")});b(document).trigger("widget-added",[b(".module-widget-form-placeholder")])}})}}var g=b("#tfb_module_settings .tfb_lb_option.module-widget-select-field");
a.find(".module-widget-select-field").on("change",function(){b(".module-widget-form-placeholder").empty();e()});e()})},isValidate:function(a){if(0===a.find("[data-validation]").length)return!0;var c=this,d={};a.find("[data-validation]").each(function(){var a=b(this),e=b(this).data("validation"),h="";a.is("select, input, textarea")&&(h=a.val());c.checkValidate(e,h)||(d[a.prop("id")]=a.data("error-msg"))});a.find(".tb_field_error").removeClass("tb_field_error").end().find(".tb_field_error_msg").remove();
if(_.isEmpty(d))return!0;_.each(d,function(a,c){var d=b("#"+c);d.addClass("tb_field_error");b("<span/>",{"class":"tb_field_error_msg","data-error-key":c}).text(a).insertAfter(d)});return!1},checkValidate:function(a,b){return e.Forms.get_validator(a)(b)}};e.Forms.register_validator=function(a,b){this.Validators[a]=b};e.Forms.get_validator=function(a){return this.Validators.hasOwnProperty(a)?this.Validators[a]:this.Validators.not_empty};e.Forms.register_validator("email",function(a){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
a=a.split(",");return b.map(a,function(a,b){return c.test(a)?null:"1"}).length?!1:!0});e.Forms.register_validator("not_empty",function(a){return a&&""!==a.trim()?!0:!1});e.Views.Toolbar=Backbone.View.extend({events:{"click .tb_toolbar_add_modules":"toogle_module_panel","hover .tb_toolbar_add_modules":"toggle_module_panel_hover","click .add_module_btn":"add_module","click .js-themify-builder-undo-btn":"action_undo","click .js-themify-builder-redo-btn":"action_redo","click .themify_builder_import_file":"import_file",
"click .themify_builder_import_page":"import_page","click .themify_builder_import_post":"import_post","click .themify_builder_load_layout":"load_layout","click .themify_builder_save_layout":"save_layout","click .themify_builder_dup_link":"duplicate","click .themify_builder_load_revision":"load_revision","click .themify_builder_save_revision":"save_revision","click .tb_toolbar_save":"save","click .tb_toolbar_close_btn":"panel_close","click .tb_module_panel_lock":"lock","click .tb_toolbar_revision_btn":"toggle_rev_dropdown",
"click .js--themify_builder_breakpoint_switcher":"breakpoint_switcher"},initialize:function(){var a=this,c=b("body"),d=b("html,body"),f="",g=wp.template("builder_module_item_draggable"),h=wp.template("builder_addon_popover");b("body").append(h({}));_.each(_.sortBy(themifyBuilder.modules,"name"),function(a,b){f+=g({slug:a.slug,name:a.name})});this.$(".tb_module_panel_modules_wrap").html(f);b(".tb_plus_btn_popover .tb_pc_module_holder").html(f);new SimpleBar(b(".tb_plus_btn_popover .tb_pc_module_holder")[0]);
h={appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:".themify_module_holder",cursorAt:{top:10,left:40},drag:function(b,e){e.helper.addClass("tb_module_dragging_helper").removeClass("themify_builder_module");a._hide_module_panel();c.hasClass("tb_module_on_dragging")||c.addClass("tb_module_on_dragging");d.hasClass("tb_preview_fullheight")||d.addClass("tb_preview_fullheight")},stop:function(a,b){c.hasClass("tb_module_on_dragging")&&c.removeClass("tb_module_on_dragging");d.hasClass("tb_preview_fullheight")&&
d.removeClass("tb_preview_fullheight")}};this.$(".themify_builder_module").draggable(h);b(".tb_plus_btn_popover .themify_builder_module").draggable(h);0<document.getElementsByClassName("tb_toolbar_menu").length&&(ThemifyBuilderCommon.undoManager.instance.setCallback(this.undoManagerCallback.bind(this)),this.updateUndoBtns(),e.vent.on("dom:observer:start",function(a,b){b=b||{};ThemifyBuilderCommon.undoManager.setStartValue(a[0].innerHTML);ThemifyBuilderCommon.undoManager.setStartData(b);"visual"===
e.mode&&ThemifyBuilderCommon.undoManager.setStartStyleValue(e.styleSheet.getCSSText());console.log("dom:observer:start")}).on("dom:observer:end",function(a,b){b=b||{};var c=ThemifyBuilderCommon.undoManager.getStartValue(),d=ThemifyBuilderCommon.undoManager.getStartData(),f=a[0].innerHTML,g=null;"visual"===e.mode&&(g={startValue:ThemifyBuilderCommon.undoManager.getStartStyleValue(),newValue:e.styleSheet.getCSSText()});c!==f&&(ThemifyBuilderCommon.undoManager.set(a,c,f,d,b,g),e.editing=!0,console.log("dom:observer:end"))}));
c.on("builder_toggle_frontend",function(b,d){d&&a.is_locked?c.addClass("tb_module_panel_locked"):!d&&a.is_locked&&c.removeClass("tb_module_panel_locked")}).on("click",function(c){c.hasOwnProperty("originalEvent")&&(a.is_locked||"tb_toolbar"===c.target.id||b(c.target).closest("#tb_toolbar").length||b(c.target).hasClass("js-tb_empty_row_btn")||a._hide_module_panel())}).on("click",".tb_module_types a",function(c){b(c.target).closest(".tb_plus_btn_popover").length?a.change_tab(c,".tb_plus_btn_popover"):
a.change_tab(c,"#tb_module_panel")}).on("change",".tb_module_panel_rows_wrap",function(b){a.load_row_templates(b)}).on("click",".tb_row_cat_filter a",function(c){b(c.target).closest(".tb_plus_btn_popover").length?a.category_sort_row_tmpl(c,".tb_plus_btn_popover"):a.category_sort_row_tmpl(c,"#tb_module_panel")}).on("keyup",".tb_module_panel_search_text",function(c){b(c.target).closest(".tb_plus_btn_popover").length?a.search(c,".tb_plus_btn_popover"):a.search(c,"#tb_module_panel")});this.$(".tb_toolbar_save").on({focusout:function(){b(this).data("timer",
setTimeout(function(){a.$(".tb_toolbar_revision_btn").removeClass("tb_toolbar_rev_hover")}.bind(this),300))},focusin:function(){clearTimeout(b(this).data("timer"))}});new SimpleBar(this.$(".tb_module_panel_modules_wrap")[0]);this.on("hide-distraction-panel",function(){this._hide_distraction_module_panel()}).on("show-distraction-panel",function(){this._show_distraction_module_panel()});this.$(".tb_export_link").prop("href",this.$(".tb_export_link").prop("href").replace("data.post_ID",themifyBuilder.post_ID));
"visual"===e.mode&&this._setupModulePanelState()},toogle_module_panel:function(a){a.preventDefault();b(a.currentTarget).hasClass("tb_disabled")||(this.is_locked&&(this.is_locked=!1,b(".tb_module_panel_lock").removeClass("tb_locked"),"visual"===e.mode&&b("body").removeClass("tb_module_panel_locked")),this.$("#tb_module_panel").toggleClass("tb_module_panel_show"))},toggle_module_panel_hover:function(a){a.stopPropagation();b(a.currentTarget).hasClass("tb_disabled")||"mouseenter"===a.type&&this.$("#tb_module_panel").addClass("tb_module_panel_show")},
add_module:function(a){a.preventDefault();this._hide_module_panel();a=e.Views.init_module({mod_name:b(a.currentTarget).closest(".themify_builder_module").data("module-slug")},e.Instances.Builder[0].type);var c=e.Instances.Builder[0].$el.find(".themify_builder_row:visible").first().find(".themify_module_holder").first(),c=a.view.render().$el.appendTo(c);b("html,body").animate({scrollTop:c.offset().top-300},500);a.view.trigger("edit");a.view.trigger("custom:preview:init")},btnUndo:document.getElementsByClassName("js-themify-builder-undo-btn")[0],
btnRedo:document.getElementsByClassName("js-themify-builder-redo-btn")[0],action_undo:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_disabled")||(ThemifyBuilderCommon.undoManager.instance.undo(),this.updateUndoBtns(),this.undoUpdateCallback())},action_redo:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_disabled")||(ThemifyBuilderCommon.undoManager.instance.redo(),this.updateUndoBtns(),this.undoUpdateCallback())},updateUndoBtns:function(){ThemifyBuilderCommon.undoManager.instance.hasUndo()?
this.btnUndo.classList.remove("tb_disabled"):this.btnUndo.classList.add("tb_disabled");ThemifyBuilderCommon.undoManager.instance.hasRedo()?this.btnRedo.classList.remove("tb_disabled"):this.btnRedo.classList.add("tb_disabled")},undoManagerCallback:function(){console.log("undo callback");this.updateUndoBtns();ThemifyBuilderCommon.undoManager.startValue=null},undoUpdateCallback:function(){e.Utils.columnDrag(null,!1);b(".themify_builder_module_front_overlay").hide();b(".themify_builder_dropdown_front").removeAttr("style");
b(".themify_builder_col").css({height:"",position:"",zIndex:""});b(".themify_grid_drag_placeholder,.themify_builder_sortable_helper").remove();b(".tb_module_dragging_helper").remove();"visual"===e.mode&&e.Utils.loadContentJs();e.vent.trigger("dom:builder:change");"visual"===e.mode&&e.Frontend.responsiveFrame.doSync()},import_file:function(a){a.preventDefault();a={dataType:"html",data:{action:"builder_import_file"}};var b=this.builderImportPlupload;confirm(themifyBuilder.i18n.importFileConfirm)&&ThemifyBuilderCommon.Lightbox.open(a,
b)},import_page:function(a){a.preventDefault();this.builderImport("page")},import_post:function(a){a.preventDefault();this.builderImport("post")},builderImport:function(a){ThemifyBuilderCommon.Lightbox.open({dataType:"html",data:{action:"builder_import",type:a}},null)},builderImportPlupload:function(){var a=b(".themify-builder-plupload-upload-uic");if(0<a.length){var c=!1;a.each(function(){var a=b(this).attr("id").replace("themify-builder-plupload-upload-ui","");c=JSON.parse(JSON.stringify(themify_builder_plupload_init));
c.browse_button=a+c.browse_button;c.container=a+c.container;c.drop_element=a+c.drop_element;c.file_data_name=a+c.file_data_name;c.multipart_params.imgid=a;c.multipart_params._ajax_nonce=themifyBuilder.tfb_load_nonce;c.multipart_params.topost=themifyBuilder.post_ID;a=new plupload.Uploader(c);a.bind("Init",function(a){});a.init();a.bind("FilesAdded",function(a,b){a.refresh();a.start();ThemifyBuilderCommon.showLoader("show")});a.bind("Error",function(a,c){var d=b(".prompt-box .show-error");b(".prompt-box .show-login").hide();
d.show();0<d.length&&d.html('<p class="prompt-error">'+c.message+"</p>");b(".overlay, .prompt-box").fadeIn(500)});a.bind("FileUploaded",function(a,c,d){a=JSON.parse(d.response);var e="200"!=d.status||a.error?"error":"done";b("#themify_builder_alert").removeClass("busy").addClass(e).delay(800).fadeOut(800,function(){b(this).removeClass(e)});a.error?alert(a.error):b("#themify_builder_alert").promise().done(function(){ThemifyBuilderCommon.Lightbox.close();window.location.reload()})})})}},load_layout:function(a){a.preventDefault();
var c=this;ThemifyBuilderCommon.Lightbox.open({dataType:"html",data:{action:"tfb_load_layout"}},function(){var a=b("#themify_builder_tabs_pre-designed"),e=b('<div class="themify-builder-alert busy"></div>').appendTo(a);b.getJSON("https://themify.me/themify-layouts/index.json").done(function(d){var e=wp.template("themify-builder-layout-item"),f=[];a.append(e(d));c.layoutLayoutsList();a.find("li.layout_preview_list").each(function(){var a=b(this).data("category").split(",");b.each(a,function(a,c){""!==
c&&-1===b.inArray(c,f)&&(f.push(c),b("#themify_builder_pre-designed-filter").append('<li><a href="#">'+c+"</a></li>"))})});b("#themify_builder_pre-designed-filter").show().find("a").click(function(d){d.preventDefault();b(this).hasClass("selected")||(b(this).hasClass("all")?a.find(".layout_preview_list").css("display","block"):(d=b(this).text(),a.find(".layout_preview_list").css("display","none").filter('[data-category*="'+d+'"]').css("display","block")),b(this).addClass("selected").parent().siblings().find("a").removeClass("selected"),
c.layoutLayoutsList())});b("#themify_builder_layout_search").on("keyup",function(){var d=b(this).val();d?(0< !b("#themify_builder_pre-designed-filter a.all.selected").length&&b("#themify_builder_pre-designed-filter a.all").click(),a.find(".layout_preview_list").hide(),a.find(".layout_title:contains("+d+")").each(function(){b(this).closest(".layout_preview_list").show()})):a.find(".layout_preview_list").css("display","block");c.layoutLayoutsList()});b("#themify_builder_load_template_form .themify_builder_tabs").on("tabsactivate",
function(a,b){c.layoutLayoutsList()})}).fail(function(a,c,d){ThemifyBuilderCommon.LiteLightbox.alert(b("#themify_builder_load_layout_error").show().text())}).always(function(){e.fadeOut()})})},layoutLayoutsList:function(){b("#themify_builder_load_template_form .themify_builder_layout_lists").each(function(){b(".layout-column-break",this).removeClass("layout-column-break");var a=0;b(".layout_preview_list:visible",this).each(function(){1==a++/4&&(b(this).addClass("layout-column-break"),a=1)}).filter(":eq(0)").addClass("layout-column-break")})},
save_layout:function(a){a.preventDefault();ThemifyBuilderCommon.Lightbox.open({data:{action:"tfb_custom_layout_form",postid:themifyBuilder.post_ID}},function(){e.Utils.builderPlupload("normal")})},duplicate:function(a){a.preventDefault();confirm(themifyBuilder.i18n.confirm_on_duplicate_page)?e.Utils.saveBuilder(!0).done(this.duplicatePageAjax):this.duplicatePageAjax()},duplicatePageAjax:function(){b.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tfb_duplicate_page",tfb_load_nonce:themifyBuilder.tfb_load_nonce,
tfb_post_id:themifyBuilder.post_ID,tfb_is_admin:"visual"===e.mode?0:1},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.showLoader("hide");a=a.new_url.replace(/\&amp;/g,"&");window.location.href=a}})},preDesigned_rows:!1,load_row_templates:function(a,c){a.preventDefault();if(!this.preDesigned_rows){var d=this;ThemifyBuilderCommon.showLoader("show");b.getJSON("https://themify.me/public-api/predesigned-rows/index.json").done(function(a){ThemifyBuilderCommon.showLoader("hide");
d.init_row_template(a)}).fail(function(a,c,e){ThemifyBuilderCommon.showLoader("error");d.preDesigned_rows=!1;b(".tb_predesigned_rows_list").html("<h3>Failed to load Pre-Designed Rows from server.</h3>")})}},init_row_template:function(a,b){this.preDesigned_rows={tmpl:a,cat:[]};for(var c,e=0;e<a.length;e++){c=a[e].category.split(",");if(Array.isArray(c))for(var g=0;g<c.length;g++)-1==this.preDesigned_rows.cat.indexOf(c[g])&&this.preDesigned_rows.cat.push(c[g]);else-1==this.preDesigned_rows.cat.indexOf(c)&&
this.preDesigned_rows.cat.push(c);if(""==a[e].thumbnail||_.isUndefined(a[e].thumbnail)||!a[e].thumbnail)this.preDesigned_rows.tmpl[e].thumbnail="https://placeholdit.imgix.net/~text?txtsize=24&txt="+encodeURI(a[e].title)+"&w=181&h=77"}this.preDesigned_rows.cat.sort();this.category_list();this.show_row_templates("all")},get_row_template:function(a,c){b.getJSON("https://themify.me/public-api/predesigned-rows/"+a+".txt").done(function(a){_.isUndefined(c)||c(a)}).fail(function(a,b,c){ThemifyBuilderCommon.showLoader("error");
alert("Failed to fetch row template")})},put_row_template:function(a){a=a.data("id");a=this.preDesigned_rows.tmpl[a];ThemifyBuilderCommon.showLoader("show");this.get_row_template(a.slug,function(a){a=a[0];a=e.Views.init_row(a,themifybuilderapp.mode).view.render().el;b(".predesigned_rows_temp_holder").replaceWith(a);"visual"===themifybuilderapp.mode&&themifybuilderapp.Mixins.Builder.refreshRows();ThemifyBuilderCommon.showLoader("hide")})},show_row_templates:function(a,c){c=_.isUndefined(c)?"":c+" ";
b(c+".tb_module_panel_rows_wrap .tb_predesigned_rows_list").empty();var d=this.preDesigned_rows.tmpl;if(_.isUndefined(a)||"all"==a.toLowerCase()||!a)for(var e=0;e<d.length;e++)b(c+".tb_module_panel_rows_wrap .tb_predesigned_rows_list").append('<div class="predesigned_row search_able_item" data-type="predesigned-rows" data-id="'+e+'"><figure class="tb_predesigned_rows_list_image"><img src="'+d[e].thumbnail+'"></figure><span class="tb_predesigned_rows_list_title search_able_title">'+d[e].title+"</span></div>");
else for(e=0;e<d.length;e++)-1!=d[e].category.split(",").indexOf(a)&&b(c+".tb_module_panel_rows_wrap .tb_predesigned_rows_list").append('<div class="predesigned_row search_able_item" data-type="predesigned-rows" data-id="'+e+'"><figure class="tb_predesigned_rows_list_image"><img src="'+d[e].thumbnail+'"></figure><span class="tb_predesigned_rows_list_title search_able_title">'+d[e].title+"</span></div>");c?new SimpleBar(b(c+".tb_module_panel_rows_wrap .tb_predesigned_rows_list")[0]):b(".tb_module_panel_rows_wrap .tb_predesigned_rows_list").each(function(a,
b){new SimpleBar(b)});var g=this,h=b("body");b(".predesigned_row").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content",cursorAt:{top:10,left:40},start:function(a,b){b.helper.addClass("tb_module_dragging_helper").removeClass("predesigned_row");b.helper.find(".tb_predesigned_rows_list_image").remove();g._hide_module_panel();h.hasClass("tb_predesigned_on_dragging")||h.addClass("tb_predesigned_on_dragging")},stop:function(a,
b){h.hasClass("tb_predesigned_on_dragging")&&h.removeClass("tb_predesigned_on_dragging")}})},category_list:function(){b(".tb_row_cat_filter_wrap .tb_row_cat_filter").empty();for(var a=this.preDesigned_rows.cat,c=0;c<a.length;c++)b(".tb_row_cat_filter_wrap .tb_row_cat_filter").append('<li><a href="#">'+a[c]+"</a></li>");b(".tb_row_cat_filter_wrap .tb_row_cat_filter").prepend('<li><a href="#">All</a></li>')},category_sort_row_tmpl:function(a,c){a.preventDefault();var d=b(a.target);this.preDesigned_rows&&
(this.show_row_templates(d.text(),c),d.closest(".tb_row_cat_filter_wrap").children(".tb_row_cat_filter_active").text(d.text()))},load_revision:function(a){a.preventDefault();a.stopPropagation();ThemifyBuilderCommon.Lightbox.open({data:{action:"tfb_load_revision_lists",postid:themifyBuilder.post_ID,tfb_load_nonce:themifyBuilder.tfb_load_nonce}},function(){b(".themify_builder_options_tab li:first-child").addClass("current")})},save_revision:function(a){a.preventDefault();a.stopPropagation();ThemifyBuilderCommon._saveRevision()},
save:function(a){a.preventDefault();e.Utils.saveBuilder(!0).fail(function(){alert(themifyBuilder.i18n.errorSaveBuilder)})},panel_close:function(a){e.toggleFrontEdit(a)},search:function(a,c){var d=b(a.currentTarget).val(),e=this.current_tab(c);console.log(e);d?(e.find(".search_able_item").hide(),b(c+" .search_able_title:contains("+d+")").each(function(){b(this).closest(".search_able_item").show()})):e.find(".search_able_item").show()},clear_search:function(){b(".tb_module_panel_search_text").val("");
b("#tb_module_panel .search_able_item, .tb_plus_btn_popover .search_able_item").show()},is_locked:!1,lock:function(a){a.preventDefault();this._set_panel_lock(!this.is_locked);b(a.currentTarget).toggleClass("tb_locked");this.$(".tb_toolbar_add_modules").toggleClass("tb_disabled");this._hide_module_panel();"visual"===e.mode&&b("body").toggleClass("tb_module_panel_locked")},_set_panel_lock:function(a){this.is_locked=a;localStorage.setItem("tb_module_panel_locked",this.is_locked)},change_tab:function(a,
c){a.preventDefault();var d=b(a.target),e=this.current_tab(c);e&&e.hide();b(c+" ul.tb_module_types li").removeClass("active");d.closest("li").addClass("active");b(c+" ."+d.data("target")).show().trigger("change");this.clear_search()},current_tab:function(a){var c=b(a+" .tb_module_types li.active a");return 0<c.length?b(a+" ."+c.data("target")):!1},tab_loader_pic:function(a,c){var d=b(a);0<d.length&&("remove"==c?d.find(".tb_tab_loader_pic").remove():d.append('<span class="tb_tab_loader_pic">Spin</span>'));
return!1},_setupModulePanelState:function(){var a=localStorage.getItem("tb_module_panel_locked");_.isNull(a)||"true"!==a||(this.$("#tb_module_panel").addClass("tb_module_panel_show"),this.$(".tb_module_panel_lock").addClass("tb_locked"),this.$(".tb_toolbar_add_modules").toggleClass("tb_disabled"),b("body").addClass("tb_module_panel_locked"),this.is_locked=!0)},toggle_rev_dropdown:function(a){a.preventDefault();b(a.currentTarget).toggleClass("tb_toolbar_rev_hover");this.$(".tb_toolbar_save").focus()},
breakpoint_switcher:function(a){a.preventDefault();if(!themifyBuilder.is_premium)return!1;var c=b(a.currentTarget),d="desktop";a=e.activeBreakPoint;c.hasClass("breakpoint-tablet")?d="tablet":c.hasClass("breakpoint-tablet-landscape")?d="tablet_landscape":c.hasClass("breakpoint-mobile")&&(d="mobile");if(a===d)return!1;"visual"===e.mode&&"desktop"===d&&b(".themify_builder_grid_"+d+" .themify_builder_column_direction li.selected a").trigger("click");e.activeBreakPoint=d;c.addClass("tb_selected").parent().siblings().find("a").removeClass("tb_selected");
"visual"!==e.mode?(c="tablet_landscape"===d?"tablet":d,b(".themify_builder_row_panel").removeClass(a+"-responsive-selected").addClass(d+"-responsive-selected").find('.grid_tabs a[href="#'+c+'"]').trigger("click")):(b("body").add(e.Frontend.responsiveFrame.$el.find("body")).removeClass("builder-active-breakpoint--desktop builder-active-breakpoint--tablet builder-active-breakpoint--tablet_landscape builder-active-breakpoint--mobile").addClass("builder-active-breakpoint--"+d).removeClass("tb_tablet tb_mobile tb_desktop").addClass("tb_"+
d.replace("_landscape","")),"desktop"===d?(b(".themify_builder_site_canvas").animate({width:b(window).width()},800,function(){b(".themify_builder_workspace_container").removeClass("onshow")}),document.body.style.height="",document.body.style.paddingBottom="",this.$(".tb_toolbar_add_modules").removeClass("tb_disabled")):("desktop"===a&&e.Frontend.responsiveFrame.sync(),"mobile"!==d&&"mobile"!==a&&"desktop"!==a||e.Frontend.responsiveFrame.$el.find(".themify_builder_grid_"+("tablet_landscape"===d?"tablet":
d)+" .themify_builder_column_direction li.selected a").trigger("click"),e.Frontend.responsiveFrame.$el.find(".module_column").each(function(a,b){b.style.width&&(b.style.width="")}),b(".themify_builder_workspace_container").addClass("onshow"),b(".themify_builder_site_canvas").animate({width:e.Utils.getBPWidth(d)-1},800,function(){"mobile"!==d?e.Frontend.responsiveFrame.$el.find(".mobile-auto").removeClass("mobile-auto").addClass("tmp-mobile-auto"):e.Frontend.responsiveFrame.$el.find(".tmp-mobile-auto").removeClass("tmp-mobile-auto").addClass("mobile-auto");
setTimeout(function(){document.body.style.height=e.Frontend.responsiveFrame.contentWindow.document.body.scrollHeight+"px"},500);e.Frontend.responsiveFrame.contentWindow.scrollTo(0,b(window).scrollTop())}),this._disable_module_panel()),setTimeout(function(){var a=e.Frontend.responsiveFrame.$el.find("body");a.trigger("builderSwitchBreakpoint.themify",[a])},1E3))},_hide_module_panel:function(){this.is_locked||this.$("#tb_module_panel").hasClass("tb_module_panel_show")&&this.$("#tb_module_panel").removeClass("tb_module_panel_show")},
_show_module_panel:function(){this.is_locked||this.$("#tb_module_panel").hasClass("tb_module_panel_show")||this.$("#tb_module_panel").addClass("tb_module_panel_show")},_disable_module_panel:function(){this._set_panel_lock(!1);this.$(".tb_toolbar_add_modules").addClass("tb_disabled");this.$(".tb_module_panel_lock").removeClass("tb_locked");"visual"===e.mode&&b("body").removeClass("tb_module_panel_locked");this._hide_module_panel()},reopen_module_panel:!1,_hide_distraction_module_panel:function(){this.$("#tb_module_panel").hasClass("tb_module_panel_show")?
(this.$("#tb_module_panel").removeClass("tb_module_panel_show"),this.is_locked&&b("body").removeClass("tb_module_panel_locked"),this.reopen_module_panel=!0):this.reopen_module_panel=!1},_show_distraction_module_panel:function(){!this.$("#tb_module_panel").hasClass("tb_module_panel_show")&&this.reopen_module_panel&&(this.$("#tb_module_panel").addClass("tb_module_panel_show"),this.is_locked&&b("body").addClass("tb_module_panel_locked"),this.reopen_module_panel=!1)}});e.Views.bindEvents=function(){ThemifyBuilderCommon.setupLoader();
ThemifyBuilderCommon.Lightbox.setup();ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.$el.addClass("themify_builder_lite_lightbox_modal")});e.Utils.setupTooltips();e.Utils.mediaUploader();e.Utils.openGallery();var a=function(a){b(a).hasClass("themify_builder_module_front")?b(a).find(".themify_builder_dropdown_front:first").toggleClass("compact-mode",370>b(a).width()):b(a).find(".themify_builder_column_action:first").toggleClass("compact-mode",184>b(a).width())};b("body").on("mouseenter",
".themify_builder_col, .themify_builder_module_front",function(b){b.stopPropagation();a(this)});setTimeout(function(){b(".themify_builder_col, .themify_builder_module_front").each(function(){a(this)})},500)};e.Utils={clearClass:"col6-1 col5-1 col4-1 col4-2 col4-3 col3-1 col3-2 col2-1 col-full",gridClass:"col-full col4-1 col4-2 col4-3 col3-1 col3-2 col6-1 col5-1".split(" "),tfb_hidden_editor_object:null,_addNewColumn:function(a,b){var c=e.Views.init_column({grid_class:a.newclass,component_name:a.component},
a.type);b.append(c.view.render().$el)},removeGridClass:function(a,b){b=b.split(",");for(var c=a.prop("class").replace(/ +(?= )/g,"").split(" "),e=0;e<c.length;e++)for(var g=0;g<b.length;g++)-1!==c[e].indexOf(b[g])&&-1===c[e].indexOf("col-direction")&&a.removeClass(c[e])},removeEmptyFields:function(a){return a},hideResponsiveCols:function(a,c){if(c){c=parseInt(c);var d=0===c%2;a.hide().each(function(){var a=parseInt(b(this).children("a").data("col"));a===c||1===a||d&&0===c%a?b(this).show():!d&&c>a&&
(5===c&&(2===a||3===a)||3===c&&2===a)&&b(this).show()});var e=a.first().closest(".themify_builder_grid_list_wrapper").find(".themify_builder_column_direction");1===c?e.hide():e.show()}},filterClass:function(a){var c=this.gridClass.concat(["first","last"]);a=a.split(" ");for(var d=[],e=0;e<a.length;e++)-1<b.inArray(a[e],c)&&d.push(a[e]);return d.join(" ")},_getRowSettings:function(a,c){var d=this,f={},g={};a.find(".themify_builder_row_content").children(".themify_builder_col").each(function(a){var c=
d.filterClass(b(this).attr("class")),f={};b(this).find(".themify_module_holder").first().children().each(function(a){if(b(this).hasClass("active_module")){var c=b(this).data("cid"),c=e.Models.Registry.lookup(c);f[a]={mod_name:c.get("mod_name"),mod_settings:c.get("mod_settings")}}b(this).hasClass("themify_builder_sub_row")&&(f[a]=d._getSubRowSettings(b(this),a))});g[a]={column_order:a,grid_class:c,modules:f};b(this).prop("style").width&&(g[a].grid_width=parseFloat(b(this).prop("style").width));0<b(this).children(".column-data-styling").length&&
(c=b.parseJSON(b(this).children(".column-data-styling").attr("data-styling")),"object"===typeof c&&(g[a].styling=c))});f={row_order:c,cols:g};"gutter-default"!==a.data("gutter")&&(f.gutter=a.data("gutter"));"col_align_top"!==a.data("column-alignment")&&(f.column_alignment=a.data("column-alignment"));"ltr"!==a.data("desktop_dir")&&(f.desktop_dir=a.data("desktop_dir"));"ltr"!==a.data("tablet_dir")&&(f.tablet_dir=a.data("tablet_dir"));"ltr"!==a.data("mobile_dir")&&(f.mobile_dir=a.data("mobile_dir"));
"tablet-auto"!==b.trim(a.data("tablet"))&&(f.col_tablet=b.trim(a.data("tablet")));"mobile-auto"!==b.trim(a.data("mobile"))&&(f.col_mobile=b.trim(a.data("mobile")));if(0<a.find(".row-data-styling").length){var h=b.parseJSON(a.find(".row-data-styling").attr("data-styling"));"object"===typeof h&&(f.styling=h)}return f},_getSubRowSettings:function(a,c){var d=this,f={},g={};a.find(".themify_builder_col").each(function(a){var c=d.filterClass(b(this).attr("class")),f={};b(this).find(".active_module").each(function(a){var c=
b(this).data("cid"),c=e.Models.Registry.lookup(c);f[a]={mod_name:c.get("mod_name"),mod_settings:c.get("mod_settings")}});g[a]={column_order:a,grid_class:c,modules:f};b(this).prop("style").width&&(g[a].grid_width=parseFloat(b(this).prop("style").width));0<b(this).children(".column-data-styling").length&&(c=b.parseJSON(b(this).children(".column-data-styling").attr("data-styling")),"object"===typeof c&&(g[a].styling=c))});f={row_order:c,cols:g};"gutter-default"!==a.data("gutter")&&(f.gutter=a.data("gutter"));
"col_align_top"!==a.data("column-alignment")&&(f.column_alignment=a.data("column-alignment"));"ltr"!==a.data("desktop_dir")&&(f.desktop_dir=a.data("desktop_dir"));"ltr"!==a.data("tablet_dir")&&(f.tablet_dir=a.data("tablet_dir"));"ltr"!==a.data("mobile_dir")&&(f.mobile_dir=a.data("mobile_dir"));"tablet-auto"!==b.trim(a.data("tablet"))&&(f.col_tablet=b.trim(a.data("tablet")));"mobile-auto"!==b.trim(a.data("mobile"))&&(f.col_mobile=b.trim(a.data("mobile")));if(0<a.find(".subrow-data-styling").length){var h=
b.parseJSON(a.find(".subrow-data-styling").attr("data-styling"));"object"===typeof h&&(f.styling=h)}return f},builderPlupload:function(a){a=b(".themify-builder-plupload-upload-uic"+("new_elemn"===a?".plupload-clone":""));if(0<a.length){var c=!1;a.each(function(){var a=b(this),e=a.attr("id").replace("themify-builder-plupload-upload-ui","");c=JSON.parse(JSON.stringify(themify_builder_plupload_init));c.browse_button=e+c.browse_button;c.container=e+c.container;c.drop_element=e+c.drop_element;c.file_data_name=
e+c.file_data_name;c.multipart_params.imgid=e;c.multipart_params._ajax_nonce=themifyBuilder.tfb_load_nonce;c.multipart_params.topost=themifyBuilder.post_ID;a.data("extensions")&&(c.filters[0].extensions=a.data("extensions"));e=new plupload.Uploader(c);e.bind("Init",function(a){});e.init();e.bind("FilesAdded",function(a,c){a.refresh();a.start();b("#themify_builder_alert").addClass("busy").show()});e.bind("Error",function(a,c){var d=b(".prompt-box .show-error");b(".prompt-box .show-login").hide();d.show();
0<d.length&&d.html('<p class="prompt-error">'+c.message+"</p>");b(".overlay, .prompt-box").fadeIn(500)});e.bind("FileUploaded",function(c,d,e){c=JSON.parse(e.response);var f="200"!=e.status||c.error?"error":"done";b("#themify_builder_alert").removeClass("busy").addClass(f).delay(800).fadeOut(800,function(){b(this).removeClass(f)});c.error?alert(c.error):(e=c.large_url?c.large_url:c.url,d=c.id,c=c.thumb,a.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(e).trigger("change").parent().find(".img-placeholder").empty().html(b("<img/>",
{src:c,width:50,height:50})).parent().show(),a.closest(".themify_builder_input").find(".themify-builder-uploader-input-attach-id").val(d))});a.removeClass("plupload-clone")})}},columnDrag:function(a,c,d,f){c&&(a?a.children(".themify_builder_col").css("width",""):b(".themify_builder_col").css("width",""));var g=this;c=a?a.children(".themify_builder_col").find(".themify_grid_drag"):b(".themify_grid_drag");var h=c.first().closest("[data-postid]"),k={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,
"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},l={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},t={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};if(d&&f){a=a.children(".themify_builder_col");var q=("gutter-narrow"===d?1.6:"gutter-none"===d?0:3.2)-("gutter-narrow"===f?1.6:"gutter-none"===f?0:3.2),q=parseFloat(q*(a.length-1)/a.length);a.each(function(a){b(this).prop("style").width&&
(a=parseFloat(b(this).prop("style").width)+q,b(this).css("width",a+"%"))})}else c.each(function(){var a=b(this),c=a.closest(".themify_builder_sub_row_content"),c=0===c.length?a.closest(".themify_builder_row_content"):c,d=c.children(".themify_builder_col"),f=a.closest(".themify_builder_col"),q=0,n=a.hasClass("themify_drag_right")?"w":"e",r=!1,A=0,B="w"===n?"themify_grid_drag_placeholder_right":"themify_grid_drag_placeholder_left",y,z,C,n=a.hasClass("themify_drag_right")?"w":"e";a.draggable({axis:"x",
cursor:"col-resize",distance:0,containment:".themify_builder_row_content",helper:function(a){return b('<div class="ui-widget-header themify_grid_drag_placeholder '+B+'"></div><div class="ui-widget-header themify_grid_drag_placeholder"></div>')},start:function(b,d){e.vent.trigger("dom:observer:start",h);z="rtl"===c.closest("[data-cid]").data(e.activeBreakPoint+"_dir");"w"===n?(r=z?f.prev(".themify_builder_col"):f.next(".themify_builder_col"),q=a.outerWidth()):(r=z?f.next(".themify_builder_col"):f.prev(".themify_builder_col"),
q=f.outerWidth());A=r.outerWidth()-2;C=d.position.left;y=c.outerWidth()},stop:function(a,m){b(".themify_grid_drag_placeholder").remove();e.vent.trigger("dom:observer:end",h);var q=Math.ceil(100*(f.outerWidth()/y));f.css("width",q+"%");var p=k,q=3.2;c.hasClass("gutter-narrow")?(p=l,q=1.6):c.hasClass("gutter-none")&&(p=t,q=0);var n=q*(d.length-1);d.each(function(a){a!==r.index()&&(b(this).prop("style").width?a=parseFloat(b(this).prop("style").width):(a=b.trim(g.filterClass(b(this).attr("class")).replace("first",
"").replace("last","")),a=p[a]),n+=a)});r.css("width",100-n+"%")},drag:function(a,b){if(r&&0<r.length){var c=q+("e"===n?-b.position.left:b.position.left),d=parseFloat(100*c/y);if(5<=d&&100>d){var e=A+C+("w"===n?-b.position.left:b.position.left),g=parseFloat(100*e/y);5<g&&100>g&&(r.css("width",e+"px"),f.css("width",c+"px").children("."+B).html(d.toFixed(2)+"%"),f.children(".themify_grid_drag_placeholder").last().html(g.toFixed(2)+"%"))}}}})})},initNewEditor:function(a){if("undefined"!==typeof tinyMCEPreInit.mceInit[a])return this.initMCEv4(a,
tinyMCEPreInit.mceInit[a]);var b=this.tfb_hidden_editor_object;b.elements=a;b.selector="#"+a;b.wp_autoresize_on=!1;tinyMCEPreInit.mceInit[a]=b;return this.initMCEv4(a,tinyMCEPreInit.mceInit[a])},initMCEv4:function(a,b){if(3<parseInt(tinyMCE.majorVersion)){var c=new tinyMCE.Editor(a,b,tinyMCE.EditorManager);c.render();return c}},initQuickTags:function(a){"function"===typeof QTags&&(quicktags({id:a}),QTags._buttonsInit())},setColorPicker:function(a){b(".builderColorSelectInput",a).each(function(){if(b(this).data("control-type"))return!0;
e.Views.init_control("color",{el:b(this)})})},_getColClass:function(a){for(var c=this.clearClass.split(" "),d=null,e=0;e<a.length;e++)-1<b.inArray(a[e],c)&&(d=a[e].replace("col",""));return d},saveBuilder:function(a,c,d){d=d||"main";var f=_.map(e.Instances.Builder,function(a,b){var c=a.$el.data("postid")||null,d=a.toJSON()||null;return{id:c,data:d}});console.log(f,"ids");return b.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tfb_save_data",tfb_load_nonce:themifyBuilder.tfb_load_nonce,
ids:JSON.stringify(f),tfb_saveto:d},cache:!1,beforeSend:function(b){a&&ThemifyBuilderCommon.showLoader("show")},success:function(d){a&&ThemifyBuilderCommon.showLoader("hide");b.isFunction(c)&&c.call(this,d);e.editing=!1;b("body").trigger("themify_builder_save_data")},error:function(){a&&ThemifyBuilderCommon.showLoader("error")}})},loadContentJs:function(a){"undefined"!==typeof ThemifyBuilderModuleJs&&ThemifyBuilderModuleJs.loadOnAjax(a);b("body").trigger("builder_load_on_ajax")},setupTooltips:function(){(function(){b("body").on("mouseover mouseout",
'[rel^="themify-tooltip-"]',function(a){"mouseover"===a.type?(a=b(this).data("title")?b(this).data("title"):b(this).prop("title"),b(this).append('<span class="themify_tooltip">'+a+"</span>")):b(this).children(".themify_tooltip").remove()})})();ThemifyBuilderCommon.setUpTooltip()},mediaUploader:function(){var a=b("body");a.on("click",".themify-builder-media-uploader",function(a){var c=b(this),e=c.closest(".themify_builder_input"),g=1===e.children("#background_image").length,e=1===e.children("#background_video").length,
h=wp.media.frames.file_frame=wp.media({title:c.data("uploader-title"),library:{type:c.data("library-type")?c.data("library-type"):"image"},button:{text:c.data("uploader-button-text")},multiple:!1});h.on("select",function(){var a=h.state().get("selection").first().toJSON();c.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(a.url).trigger("change").parent().find(".img-placeholder").empty().html(b("<img/>",{src:a.url,width:50,height:50})).parent().show();c.closest(".themify_builder_input").find(".themify-builder-uploader-input-attach-id").val(a.id)});
if(g||e)0===b("#hide_attachment_display_settings").length&&b("body").append('<style id="hide_attachment_display_settings">.media-modal .attachment-display-settings { display:none }</style>'),h.on("close",function(a){b("#hide_attachment_display_settings").remove()});h.open();a.preventDefault()});a.on("click",".themify-builder-delete-thumb",function(a){b(this).prev().empty().parent().hide();b(this).closest(".themify_builder_input").find(".themify-builder-uploader-input").val("").trigger("change");a.preventDefault()});
a.on("click",".insert-media",function(a){window.wpActiveEditor=b(this).data("editor")})},openGallery:function(){var a=wp.media.gallery.shortcode,c=this,d;b("body").on("click",".tf-gallery-btn",function(e){var f=b(this).closest(".themify_builder_input").find(".tf-shortcode-input");d=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:!1});wp.media.gallery.shortcode=function(b){var c=b.props.toJSON(),d=_.pick(c,
"orderby","order");b.gallery&&_.extend(d,b.gallery.toJSON());d.ids=b.pluck("id");c.uploadedTo&&(d.id=c.uploadedTo);d._orderbyRandom&&(d.orderby="rand");delete d._orderbyRandom;d.ids&&"post__in"===d.orderby&&delete d.orderby;_.each(wp.media.gallery.defaults,function(a,b){a===d[b]&&delete d[b]});b=new wp.shortcode({tag:"gallery",attrs:d,type:"single"});f.val(b.string()).trigger("change");wp.media.gallery.shortcode=a;return b};0===b("#hide_gallery_settings").length&&b("body").append('<style id="hide_gallery_settings">.media-modal .gallery-settings { display:none }</style>');
d.on("close",function(a){b("#hide_gallery_settings").remove()});d.on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+b+"]");c.setShortcodePreview(a.models,f)});0<b.trim(f.val()).length?(d=wp.media.gallery.edit(b.trim(f.val())),d.on("close",function(a){b("#hide_gallery_settings").remove()}),d.state("gallery-edit").on("update",function(a){var b=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+b+"]");c.setShortcodePreview(a.models,f)})):(d.open(),b(".media-menu").find(".media-menu-item").last().trigger("click"));
e.preventDefault()})},setShortcodePreview:function(a,b){var c=b.next(".themify_builder_shortcode_preview"),e="";0===c.length&&(b.after('<div class="themify_builder_shortcode_preview"></div>'),c=b.next(".themify_builder_shortcode_preview"));for(var g in a)var h=a[g].attributes,e=e+('<img src="'+(h.sizes.thumbnail?h.sizes.thumbnail.url:h.url)+'" width="50" height="50" />');c.html(e)},createGradientPicker:function(a,c){if("undefined"!==typeof b.fn.ThemifyGradient){var d=a.closest(".themify-gradient-field"),
f=null,g=!1,h={onChange:function(b,c,d){a.val(b);g&&"visual"===e.mode&&(b="cover_gradient-gradient"===a.prop("name"),c=e.liveStylingInstance.bindBackgroundGradient(a.data("id"),c,b),b&&c&&e.liveStylingInstance.addOrRemoveComponentOverlay(c,!0))}};h.gradient=c?c:a.attr("data-default-gradient")?a.attr("data-default-gradient"):[];a.prev().ThemifyGradient(h);f=a.prev().data("ThemifyGradient");d.find(".themify-clear-gradient").on("click",function(b){b.preventDefault();f.settings.gradient="0% rgba(255,255,255, 1)|100% rgba(255,255,255,1)";
f.update();a.val("").trigger("change");"cover_gradient-gradient"===a.prop("name")&&"visual"===e.mode&&e.liveStylingInstance.addOrRemoveComponentOverlay("")});var k=d.find(".themify-gradient-angle");d.find(".themify-gradient-type").on("change",function(){f.setType(b(this).val());var a=k.closest(".gradient-angle-knob"),c=d.find(".themify-radial-circle");"radial"===b(this).val()?(a.hide(),a.next("span").hide(),c.show()):(a.show(),a.next("span").show(),c.hide())}).trigger("change");d.find(".themify-radial-circle").on("change",
function(){f.setRadialCircle("circle"==b(this).val())}).trigger("change");k.on("change",function(){var a=parseInt(b(this).val());a||(a=0);f.setAngle(a)}).knob({change:function(a){f.setAngle(Math.round(a))}});k.trigger("change");k.removeAttr("style").focus(function(){b(this).parent().find("canvas").show()}).parent().addClass("gradient-angle-knob").hover(function(){b(this).addClass("gradient-angle-hover-state")},function(){b(this).removeClass("gradient-angle-hover-state")}).find("canvas").insertAfter(k);
b(document).bind("click",function(){k.parent().is(".gradient-angle-hover-state")||k.parent().find("canvas").hide("fast")});setTimeout(function(){g=!0;d.closest(".tf-image-gradient-field").find(".tf-option-checkbox-js:checked").trigger("change")},900)}},checkUnload:function(){b("body").hasClass("themify_builder_active")&&(window.onbeforeunload=function(){return ThemifyBuilderCommon.undoManager.instance.hasUndo()&&e.editing?themifyBuilder.i18n.confirm_on_unload:null})},getRepeaterValues:function(a){var c=
[];a.find(".tb_repeatable_field").each(function(){var a={};b(this).find(".tfb_lb_option_child").each(function(){var c=b(this).data("input-id");c||(c=b(this).attr("id"));if(b(this).hasClass("tf-radio-choice"))var d=0<b(this).find(":checked").length?b(this).find(":checked").val():"";else if(b(this).hasClass("themify-layout-icon"))c||(c=b(this).attr("id")),d=0<b(this).find(".selected").length?b(this).find(".selected").attr("id"):b(this).children().first().attr("id");else if(b(this).hasClass("themify-checkbox"))d=
[],b(this).find(":checked").each(function(a){d[a]=b(this).val()});else if(b(this).hasClass("tfb_lb_wp_editor")){var e=b(this).attr("id"),c=b(this).attr("name");d="undefined"===typeof tinyMCE||_.isNull(tinyMCE.get(e))?b(this).val():!1===tinyMCE.get(e).hidden?tinyMCE.get(e).getContent():switchEditors.wpautop(tinymce.DOM.get(e).value)}else d=b(this).val();d&&(a[c]=d)});c.push(a)});return c},toRGBA:function(a){a=a.split("_");var b=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;if("undefined"!==typeof a[0])return b=
b.exec(a[0]),a="undefined"!==typeof a[1]?a[1]:1,b?"rgba("+parseInt(b[1],16)+", "+parseInt(b[2],16)+", "+parseInt(b[3],16)+", "+a+")":""},getBPWidth:function(a){a=_.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");return a[a.length-1]},shortcodeToHTML:function(a){var b=[],d=1;_.each(themifyBuilder.available_shortcodes.split("|"),function(c,e){a=wp.shortcode.replace(c,a,function(a){b.push({key:d,sc_render:a.string()});a='<span data-rendered-sc="'+
d+'">[loading shortcode...]</span>';d++;return a})});return{tags:b,content:a}}};_.extend(e.Views.BaseElement.prototype,e.Mixins.Common);_.extend(e.Views.Builder.prototype,e.Mixins.Builder);e.Views.ControlRegistry={items:{},register:function(a,b){this.items[a]=b},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,b){a.remove()});this.items={};console.log("destroy controls")}};e.Views.Controls["default"]=Backbone.View.extend({initialize:function(a){e.Views.ControlRegistry.register(this.$el.attr("id"),
this);a.binding_type&&(this.binding_type=a.binding_type)},preview_element:function(a,b,d){if(!_.isUndefined(this.binding_type)){var c=e.activeModel.getPreviewSettings();!_.isUndefined(d)&&d.length?c[d.prop("id")]=e.Utils.getRepeaterValues(d):c[a]=b;e.activeModel.set("temp_settings",c);"live"===this.binding_type?e.activeModel.trigger("custom:preview:live",c):"refresh"===this.binding_type&&e.activeModel.trigger("custom:preview:reload")}}});e.Views.Controls["default"].extend=function(a){var b=this,d=
Backbone.View.extend.apply(this,arguments);d.prototype.events=_.extend({},this.prototype.events,a.events);d.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return d};e.Views.register_control=function(a,b){"default"!==a&&(this.Controls[a]=this.Controls["default"].extend(b))};e.Views.get_control=function(a){return this.control_exists(a)?this.Controls[a]:this.Controls["default"]};
e.Views.control_exists=function(a){return this.Controls.hasOwnProperty(a)};e.Views.init_control=function(a,b){b=b||{};"wp_editor"===a&&(b.el.hasClass("data_control_binding_refresh")&&(b.binding_type="refresh"),b.el.hasClass("data_control_binding_live")&&(b.binding_type="live"));var c=b.el.attr("data-input-id")?b.el.attr("data-input-id"):b.el.attr("id");return(c=this.ControlRegistry.lookup(c))?(c.setElement(b.el).render(),c):new (e.Views.get_control(a))(b)};e.vent.on("dom:observer:update",function(a){console.log("dom:observer:update");
a.find("[data-cid]").each(function(){var a=b(this).data("cid");(a=e.Models.Registry.lookup(a))&&a.trigger("custom:dom:update")});a.find(".themify_builder_ui_state_highlight").remove()});e.Views.register_control("wp_editor",{mceEditor:null,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("id");e.Utils.initQuickTags(c);if("undefined"!==typeof tinyMCE){var d=_.isNull(this.mceEditor)?e.Utils.initNewEditor(c):this.mceEditor,f=b.grep(this.el.className.split(" "),function(a,
b){return 0===a.indexOf("data_control_repeater_")}).join(),g=b("#"+f.replace("data_control_repeater_","")),f=function(b){a.preview_element(c,this.getContent(),g)};_.isUndefined(this.binding_type)||(d.on("keyup change",f),b("#"+c).on("keyup change",function(){a.preview_element(c,this.value,g)}))}return this},reBind:function(){this.mceEditor=tinyMCE.get(this.$el.attr("id"));this.render()},resetEditor:function(){this.mceEditor=null}});e.Views.register_control("text",{initialize:function(){this.render()},
render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d),d=function(){a.preview_element(c,this.value,e)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,e)},1E3));this.$el.on("keyup",d);return this}});e.Views.register_control("textonchange",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?
this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d),d=function(){a.preview_element(c,this.value,e)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,e)},1E3));this.$el.on("change",d);return this}});e.Views.register_control("image",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),
d=this.$el.attr("data-control-repeater"),e=b("#"+d),d=function(){a.preview_element(c,this.value,e)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,e)},1E3));this.$el.on("change",d);return this}});e.Views.register_control("textarea",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+
d),d=function(){a.preview_element(c,this.value,e)};_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,e)},1E3));this.$el.on("keyup",d);return this}});e.Views.register_control("icon",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d),d=function(){a.preview_element(c,this.value,e)};
_.isUndefined(this.binding_type)||"refresh"!==this.binding_type||(d=_.throttle(function(){a.preview_element(c,this.value,e)},1E3));this.$el.on("change",d);return this}});e.Views.register_control("query_category",{initialize:function(){this.render()},render:function(){var a=this,b=a.$el.attr("id"),d=a.$el.parent(),e=d.find(".query_category_single"),g=d.find(".query_category_multiple"),h;e.add(g).on("change",function(c){h=g.val()?g.val()+"|multiple":e.val()+"|single";a.preview_element(b,h)});return this}});
e.Views.register_control("select",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d);this.$el.on("change",function(){a.preview_element(c,this.value,e)});return this}});e.Views.register_control("layout",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),
d=this.$el.attr("data-control-repeater"),f=b("#"+d);this.$(".tfl-icon").on("click",function(d){d.preventDefault();b(this).addClass("selected").siblings().removeClass("selected");if(!_.isUndefined(a.binding_type)&&"visual"===e.mode)if(d=b(this).prop("id"),"live"===a.binding_type)if(_.isUndefined(a.$el.data("control-selector")))a.preview_element(c,d,f);else{var g=e.liveStylingInstance.$liveStyledElmt,k=e.activeModel.getPreviewSettings();k[c]=d;e.activeModel.set({temp_settings:k},{silent:!0});""!==a.$el.data("control-selector")&&
(g=e.liveStylingInstance.$liveStyledElmt.find(a.$el.data("control-selector")));k=e.liveStylingInstance.getStylingVal(c);"layout_feature"===c?(d="layout-"+d,k="layout-"+k):"columns"===c&&(d=c+"-"+d,k=c+"-"+k);console.log(d,k);g.removeClass(k).addClass(d);"layout_feature"===c?d=d.substr(7):"columns"===c&&(d=d.substr(8));e.liveStylingInstance.setStylingVal(c,d)}else a.preview_element(c,d,f)});return this}});e.Views.register_control("radio",{initialize:function(){this.render()},render:function(){var a=
this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d);this.$('input[type="radio"]').on("click",function(){a.preview_element(c,this.value,e)});return this}});e.Views.register_control("checkbox",{initialize:function(){this.render()},render:function(){var a=this,b=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id");this.$('input[type="checkbox"]').on("click",function(){if(!_.isUndefined(a.binding_type)){var c=
a.$('input[type="checkbox"]:checked').map(function(){return this.value}).get();a.preview_element(b,c.join("|"))}});return this}});e.Views.register_control("color",{is_typing:!1,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.parent().find(".builderColorSelect"),d=this.$el,e=c.parent().parent().find(".colordisplay"),g="",h=1,k=c.parent().parent().find(".color_opacity");d.val()&&(h=d.val(),-1!==h.indexOf("_")?(h=h.split("_"),g=h[0],h=h[1]?h[1]:1):(g=h,h=1),e.val(g),k.val(h));
c.minicolors({opacity:1,textfield:!1,change:_.debounce(function(f,g){var h=b(this).parent().parent().find(".builderColorSelectInput");if(f){g&&"0.99"==g&&(g="1");var l=f.replace("#","")+"_"+g;h.val(l);_.isUndefined(a.binding_type)||a.preview_element(h.prop("id"),l,b("#"+d.attr("data-control-repeater")));a.is_typing||(e.val(f.replace("#","")),k.is(":focus")||k.val(g));a.applyAll_verifyBorderColor(h,l,f.replace("#",""),f.replace("#",""),"change");b("body").trigger("themify_builder_color_picker_change",
[h.attr("name"),c.minicolors("rgbaString")])}else _.isUndefined(a.binding_type)||a.preview_element(h.prop("id"),"",b("#"+d.attr("data-control-repeater")))},200)});c.minicolors("value",g);c.minicolors("opacity",h);e.on("blur keyup",function(c){var d=b(this),e="",f=d.parent().find(".builderColorSelect"),g=d.parent().find(".builderColorSelectInput");d.val()&&(e=d.val());a.is_typing="keyup"===c.type;d.val(e.replace("#",""));g.val(d.val().replace(/[abcdef0123456789]{3,6}/i,e.replace("#","")));"keyup"===
c.type?f.minicolors("value",e):f.minicolors("value","").minicolors("value",e);a.applyAll_verifyBorderColor(g,g.val(),d.val(),e,c.type)});k.on("blur keyup",function(c){var d=b(this),e="",f=d.parent().find(".builderColorSelect");d.val()&&(e=d.val());a.is_typing="keyup"===c.type;d.val(e);f.minicolors("opacity",e)})},applyAll_verifyBorderColor:function(a,c,d,f,g){var h=!1;a=b(a);if(-1!==a.prop("name").indexOf("border_top_color")){var k=a.closest(".themify_builder_field").nextAll(".themify_builder_field");
k.each(function(){h=b(this).find(".style_apply_all_border");if(0<h.length)return!1});if(h&&h.is(":checked")){var l=null;"keyup"!==g?b(".builderColorSelectInput",k).each(function(){var a=b(this).closest(".themify_builder_input");l=a.find(".builderColorSelect");b(this).val(c);a.children(".colordisplay").val(d);l.minicolors("value",f)}):l=a.closest(".themify_builder_input").find(".builderColorSelect");"visual"===e.mode&&e.liveStylingInstance.setApplyBorder(a.prop("name"),l.minicolors("rgbaString"),"color")}}}});
e.Views.register_control("repeater",{events:{"click .toggle_row":"toggleField","hover .row_menu":e.Views.BaseElement.prototype.actionMenuHover,"click .themify_builder_duplicate_row":"duplicateRowField","click .themify_builder_delete_row":"deleteRowField"},initialize:function(){this.render();this.on("duplicate delete",this.updateElement)},updateElement:function(){this.preview_element(this.$el.attr("id"),null,this.$el)},render:function(){var a=this,c=this.$el.attr("id"),d=!1;this.$el.sortable({items:".tb_repeatable_field",
handle:".tb_repeatable_field_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursor:"move",start:_.debounce(function(c,d){"undefined"!==typeof tinyMCE&&a.$el.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,a)})},400),stop:_.debounce(function(f,g){"undefined"!==typeof tinyMCE&&a.$el.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).attr("id");tinyMCE.execCommand("mceAddEditor",
!0,a);e.Views.ControlRegistry.lookup(a).reBind()});d&&(g.item.removeClass("collapsed").find(".tb_repeatable_field_content").show(),d=!1);a.preview_element(c,null,a.$el);a.$el.find(".themify_builder_ui_state_highlight").remove()},400),sort:function(b,c){a.$el.find(".themify_builder_ui_state_highlight").height(30)},beforeStart:function(b,c){c.item.hasClass("collapsed")||(c.item.addClass("collapsed").find(".tb_repeatable_field_content").hide(),d=!0,a.$el.sortable("refresh"))}});return this},toggleField:function(a){a.preventDefault();
b(a.currentTarget).parents(".tb_repeatable_field").toggleClass("collapsed").find(".tb_repeatable_field_content").slideToggle()},duplicateRowField:function(a){a.preventDefault();var c=this.$el,d=b(a.currentTarget).closest(".tb_repeatable_field");a=d.clone();var f=c.find(".tb_repeatable_field:visible").length+1,g=f+Math.floor(9*Math.random());a.find(".tfb_lb_wp_editor.tfb_lb_option_child").each(function(){var a=b(this).parents(".wp-editor-wrap").parent(),d=e.cache.repeaterElements[c.attr("id")].find(".wp-editor-wrap").parent().clone(),
f=d.find(".tfb_lb_wp_editor").prop("id"),g=b(this).prop("id"),n=b(this).prop("name"),x=g+"_"+ThemifyBuilderCommon.randNumber(),d=d.html().replace(new RegExp(f,"g"),x),g="undefined"!==typeof tinyMCE?!1===tinyMCE.get(g).hidden?tinyMCE.get(g).getContent():switchEditors.wpautop(tinymce.DOM.get(g).value):b("#"+g).val();a.html(d).find(".tfb_lb_wp_editor").prop("name",n).val(g).addClass("newEditor")});a.find("textarea:not(.tfb_lb_wp_editor)").each(function(a){(a=d.find("textarea").eq(a).val())&&b(this).val(a)});
a.find(".themify-builder-radio-dnd").each(function(a){var c=b(this).attr("name");b(this).attr({name:c+"_"+f,id:c+"_"+f+"_"+a}).next("label").attr("for",c+"_"+f+"_"+a)});a.find(".themify-builder-plupload-upload-uic").each(function(a){b(this).attr("id","pluploader_"+f+g+a+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find('input[type="button"]').attr("id","pluploader_"+f+g+a+"themify-builder-plupload-browse-button")});a.find("select").each(function(a){a=d.find("select").eq(a).find("option:selected").val();
b(this).find('option[value="'+a+'"]').prop("selected",!0)});a.find(".builderColorSelectInput").each(function(){var a=b(this),c=a.clone(),d=a.closest(".themify_builder_field");a.prev().minicolors("destroy").removeAttr("maxlength");d.find(".colordisplay").wrap('<div class="themify_builder_input" />').before('<span class="builderColorSelect"><span></span></span>').after(c)});a.find(".tfb_lb_option_child").each(function(){b(this).data("control-binding")&&b(this).data("control-type")&&e.Views.init_control(b(this).data("control-type"),
{el:b(this),binding_type:b(this).data("control-binding")})});a.insertAfter(d).find(".themify_builder_dropdown").hide();b("#tfb_module_settings").find(".tfb_lb_wp_editor.tfb_lb_option_child.newEditor").each(function(a){e.Views.init_control("wp_editor",{el:b(this)});b(this).removeClass("newEditor")});e.Utils.builderPlupload("new_elemn");this.trigger("duplicate")},deleteRowField:function(a){a.preventDefault();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(a=b(a.currentTarget).closest(".tb_repeatable_field"),
1<a.closest(".themify_builder_row_js_wrapper").find(".tb_repeatable_field:visible").length?a.remove():a.hide(),this.trigger("delete"))}});e.Views.register_control("widget_select",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id"),d=this.$el.attr("data-control-repeater"),e=b("#"+d);this.$el.on("change",function(){a.preview_element(c,this.value,e)});return this}});e.Views.register_control("widget_form",
{initialize:function(){this.render()},render:function(){this.this_option_id=this.$el.attr("data-input-id")?this.$el.attr("data-input-id"):this.$el.attr("id");this.$el.on("change",":input",this._updateWidgetPreview.bind(this));return this},_updateWidgetPreview:function(){var a=this.$el.find(":input").themifySerializeObject();this.preview_element(this.this_option_id,a)}})})(jQuery);
