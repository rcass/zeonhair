(function(b){if(b("#page-builder.themify_write_panel").length===0){return}var a=themifybuilderapp;a.mode="skeleton";a.isPostSave=false;a.render=function(){var d=new a.Collections.Rows(themifyBuilder.builder_data);a.Instances.Builder[0]=new a.Views.Builder({el:"#themify_builder_row_wrapper",collection:d});a.Instances.Builder[0].render();var c=new a.Views.ModulePanel({el:".themify_builder_module_panel"}),g=new a.Views.Nav({el:".themify_builder_backend_options_menu"}),f=new a.Views.EditorNavComponent({el:".themify_builder_undo_tools"});b("#themify_builder_main_save").on("click",function(h){h.preventDefault();a.Utils.saveBuilder(true)});b("input#publish,input#save-post").on("click",function(h){if(h.which){b('input[name*="builder_switch_frontend"]').val(0)}if(!a.isPostSave){a.Utils.saveBuilder(false).done(function(){ThemifyBuilderCommon.undoManager.instance.clear();a.isPostSave=true;b(h.currentTarget).trigger("click")});h.preventDefault()}});b("#themify_builder_switch_frontend").on("click",this.switchFrontEnd);b('<a href="#" id="themify_builder_switch_frontend_button" class="button themify_builder_switch_frontend">'+themifyBuilder.switchToFrontendLabel+"</a>").on("click",this.switchFrontEnd).appendTo("#postdivrich #wp-content-media-buttons");if(window.sessionStorage.getItem("frontendURL")){var e=window.sessionStorage.getItem("frontendURL");window.sessionStorage.removeItem("frontendURL");ThemifyBuilderCommon.showLoader("show");window.location.href=e}b('input[name*="builder_switch_frontend"]').closest(".themify_field_row").hide();a.Views.bindEvents();a.Forms.bindEvents()};a.switchFrontEnd=function(d){d.preventDefault();var c=themifyBuilder.permalink.replace(/\&amp;/g,"&")+"#builder_active";if(b("#themify_builder_row_wrapper").is(":visible")){a.Utils.saveBuilder(true,function(){ThemifyBuilderCommon.undoManager.instance.clear();a.createPostBuilderButton(c)})}else{a.createPostBuilderButton(c)}};a.createPostBuilderButton=function(d){var c=b("#post_ID").val();if(window.location.href.indexOf(c)<0){window.sessionStorage.setItem("frontendURL",d);b("#post").trigger("submit")}else{window.location.href=d}};b(function(){var c;a.render();if(typeof window.icl_copy_from_original=="function"){c=window.icl_copy_from_original;window.icl_copy_from_original=function(d,e){c(d,e);jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"themify_builder_icl_copy_from_original",source_page_id:e,source_page_lang:d},success:function(f){if(f!="-1"){jQuery("#page-builder .themify_builder.themify_builder_admin").empty().append(f).contents().unwrap()}}})}}});b(window).load(function(){var i=b("#page-builder .themify_builder_module_panel"),j=0,g=null,h=0,e=b("#wpadminbar"),d=e.outerHeight(true);if(i.length>0){if(i.is(":visible")){c()}else{b("#themify-meta-box-tabs a").one("click",function(){if(b(this).attr("id")=="page-buildert"){c()}})}}function c(){i.width(i.width());j=i.offset().top;h=Math.round(b("#page-builder").offset().top);b("#themify_builder_module_tmp").height(i.outerHeight(true));b(window).scroll(function(){if(g){clearTimeout(g)}g=setTimeout(f,15)}).resize(function(){j=i.offset().top;i.width(b("#page-builder .themify_builder_admin").width()).css("top",e.outerHeight(true));b("#themify_builder_module_tmp").height(i.outerHeight(true))})}function f(){g=null;var l=h+b("#page-builder").height(),k=b(this).scrollTop();if(k>j&&k<l){i.addClass("themify_builder_module_panel_fixed").css("top",d);b("#themify_builder_module_tmp").css("display","block")}else{i.removeClass("themify_builder_module_panel_fixed").css("top",0);b("#themify_builder_module_tmp").css("display","none")}}})})(jQuery);