(function(a){var b={init:function(){this.galleryShortcode()},galleryShortcode:function(){var f=wp.media.gallery.shortcode,e=wp.media.gallery,c,d;a(".themify-gallery-shortcode-btn").on("click",function(h){var g=a(this).closest(".themify_field").find(".themify-gallery-shortcode-input");if(c){c.open()}else{if(a.trim(g.val()).length>0){c=e.edit(a.trim(g.val()))}else{c=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:true,multiple:true,selection:false})}}wp.media.gallery.shortcode=function(i){var k=i.props.toJSON(),j=_.pick(k,"orderby","order");if(i.gallery){_.extend(j,i.gallery.toJSON())}j.ids=i.pluck("id");if(k.uploadedTo){j.id=k.uploadedTo}if(j._orderbyRandom){j.orderby="rand"}delete j._orderbyRandom;if(j.ids&&"post__in"===j.orderby){delete j.orderby}_.each(wp.media.gallery.defaults,function(n,m){if(n===j[m]){delete j[m]}});var l=new wp.shortcode({tag:"gallery",attrs:j,type:"single"});g.val(l.string());wp.media.gallery.shortcode=f;return l};c.on("update",function(i){var j=wp.media.gallery.shortcode(i).string().slice(1,-1);g.val("["+j+"]")});if(a.trim(g.val()).length==0){a(".media-menu").find(".media-menu-item").last().trigger("click")}h.preventDefault()})}};a(document).ready(function(){b.init()})})(jQuery);