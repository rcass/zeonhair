function themify_create_pluploader(c){var e=c,j=e.attr("id"),a=j.replace("plupload-upload-ui",""),k=false,h=false,b=false,f=false,g=jQuery;var i=JSON.parse(JSON.stringify(global_plupload_init));i.browse_button=a+i.browse_button;i.container=a+i.container;i.drop_element=a+i.drop_element;i.file_data_name=a+i.file_data_name;i.multipart_params["imgid"]=a;i.multipart_params["_ajax_nonce"]=e.find(".ajaxnonceplu").attr("id").replace("ajaxnonceplu","");if(e.hasClass("add-preset")){k=true;i.multipart_params["haspreset"]="haspreset"}if(e.hasClass("add-preview")){h=true;i.multipart_params["haspreview"]="haspreview"}if(e.hasClass("add-to-media")){b=true;i.multipart_params["tomedia"]="tomedia"}if(e.data("postid")){f=true;i.multipart_params["topost"]=e.data("postid")}if(e.data("fields")){i.multipart_params["fields"]=e.data("fields")}if(e.data("featured")){i.multipart_params["featured"]=e.data("featured")}if(e.data("formats")){i.filters[0]["extensions"]=e.data("formats")}var d=new plupload.Uploader(i);d.bind("Init",function(l){});d.init();d.bind("FilesAdded",function(l,n){if(e.data("confirm")){var m=confirm(e.data("confirm"));if(!m){return}}l.refresh();l.start();g(".alert").addClass("busy").fadeIn(800)});d.bind("Error",function(l,n){g(".prompt-box .show-login").hide();g(".prompt-box .show-error").show();if(-600==n.code){var m=themify_lang.filesize_error,o=themify_lang.filesize_error_fix}if(g(".prompt-box .show-error").length>0){g(".prompt-box .show-error").html('<p class="prompt-error">'+m+"</p>");if(o){g(".prompt-box .show-error").append("<p>"+o+"</p>")}}g(".overlay, .prompt-box").fadeIn(500);return});d.bind("FileUploaded",function(s,n,q){var w=JSON.parse(q.response),r="";if("200"==q.status&&!w.error){r="done"}else{r="error"}g(".alert").removeClass("busy").addClass(r).delay(800).fadeOut(800,function(){g(this).removeClass(r)});if(w.error){g(".prompt-box .show-login").hide();g(".prompt-box .show-error").show();if(g(".prompt-box .show-error").length>0){g(".prompt-box .show-error").html('<p class="prompt-error">'+w.error+"</p>");g(".prompt-box .show-error").append("<p>"+themify_lang.enable_zip_upload+"</p>")}g(".overlay, .prompt-box").fadeIn(500);return}g("#"+n.id).fadeOut();var p=w.file,t=w.url,v=w.type;if("zip"==v||"rar"==v||"plain"==v){window.location=location.href.replace(location.hash,"")}else{g("#"+a).val(t)}if(f){var m=w.thumb;var o=g('<a href="'+t+'" target="_blank"><img src="'+m+'" width="40" /></a>').fadeIn(1000).css("display","inline-block");if(g("#"+a+"plupload-upload-ui").closest(".themify_field").children(".themify_upload_preview").find("a").length>0){g("#"+a+"plupload-upload-ui").closest(".themify_field").children(".themify_upload_preview").find("a").remove()}g("#"+a+"plupload-upload-ui").closest(".themify_field").children(".themify_upload_preview").fadeIn().append(o);e.closest(".themify_field").children(".themify_featimg_remove").removeClass("hide");g("body").trigger("themify_plupload_selected",[e,w])}if(k){g("#"+a).closest("fieldset").children(".preset").find("img").removeClass("selected");var u=t.replace(/^.*[\\\/]/,"");var l=g('<a href="#" title="'+u+'"><span title="'+p+'"></span><img src="'+t+'" alt="'+t+'" class="backgroundThumb selected" /></a>').css("display","inline-block");g("#"+a).closest("fieldset").children(".preset").append(l)}if(h){g("#"+a+"-preview").attr("src",t)}})}jQuery(document).ready(function(b){var a=b(".plupload-upload-uic");if(a.length>0){a.each(function(){themify_create_pluploader(b(this))})}});