window.Themify_Metabox=(function(c){var b={};b.init=function(){this.bind_events()},b.bind_events=function(){c(document).ready(b.document_ready)};b.document_ready=function(){b.init_metabox_tabs();b.gallery_shortcode();b.repeater();b.enable_toggle();b.query_category();b.post_meta_checkbox();b.init_fields(c("body"))},b.init_metabox_tabs=function(){c(".themify-meta-box-tabs").each(function(){var e=c(this);var d=c(".ilc-htabs li",e);if(d.length>1){ilcTabs({ilctabs:"#"+e.attr("id")})}else{c(".ilc-tab",e).show();d.addClass("select")}});c(".ilc-htabs a").on("click",function(){b.set_cookie("themify-builder-tabs",c(this).attr("id"))});if(typeof(b.get_cookie("themify-builder-tabs"))!="undefined"&&b.get_cookie("themify-builder-tabs")!==null){c("#"+b.get_cookie("themify-builder-tabs")).trigger("click")}};b.init_fields=function(d){b.layout(d);b.color_picker(d);b.date_picker(d);b.assignments(d);b.dropdownbutton(d);c(document).trigger("themify_metabox_init_fields",[b])};b.repeater=function(){c("body").on("click",".themify-repeater-add",function(j){j.preventDefault();var i=c(this),d=i.closest(".themify_field_row"),h=d.find(".themify-repeater-rows"),g=d.find(".themify-repeater-template").html();var f=1;if(h.find("> div").length){h.find("> div").each(function(){f=Math.max(f,c(this).data("id"))});f++}g=g.replace(/__i__/g,f);h.append(g);b.init_fields(h.find(".themify-repeater-row:last-child"))})};b.color_picker=function(d){d.find(".colorSelectInput").each(function(){var e={},g=c(this),f=g.data("format");if(f=="rgba"){e.format="rgb";e.opacity=true}else{if(f=="rgb"){e.format="rgb"}else{}}c(this).minicolors(e)});d.find(".clearColor").on("click",function(){c(this).parent().find(".colorSelect").minicolors("value","");c(this).parent().find(".colorSelectInput").val("");c(this).hide()})};b.date_picker=function(d){d.find(".themifyDatePicker").each(function(){var j=c(this),g=j.data("label"),i=j.data("close"),f=j.data("dateformat"),e=j.data("timeformat"),h=j.data("timeseparator");j.datetimepicker({showOn:"both",showButtonPanel:true,closeButton:i,buttonText:g,dateFormat:f,timeFormat:e,stepMinute:5,firstDay:j.data("first-day"),separator:h,onClose:function(k){if(""!=k){c("#"+j.data("clear")).addClass("themifyFadeIn")}},beforeShow:function(){c("#ui-datepicker-div").addClass("themifyDateTimePickerPanel")}});j.next().addClass("button")});d.find(".themifyClearDate").on("click",function(f){f.preventDefault();var g=c(this);c("#"+g.data("picker")).val("").trigger("change");g.removeClass("themifyFadeIn")})};b.assignments=function(d){d.find(".themify-assignments, .themify-assignment-inner-tabs").tabs()};b.layout=function(d){d.find(".preview-icon").each(function(){var j=c(this),i=j.parent(),e=i.find(".val"),k,f="",h="";if(j.closest(".group-hide").length>0){h="theme-settings";k=j.closest(".group-hide");f=k.data("hide")}else{if(j.closest(".themify_field_row").length>0){h="custom-panel";k=j.closest(".themify_field_row");if("undefined"!==typeof k.data("hide")){f=k.data("hide")}}}j.click(function(m){m.preventDefault();i.find(".selected").removeClass("selected");j.addClass("selected");e.val(j.find("img").attr("alt")).trigger("change");if(""!==f){if("custom-panel"==h){var l=k.nextUntil("[data-hide]");l.add(l.find(".themify_field .hide-if")).not(".toggled-off").filter("."+f.replace(/\s/g,",.")).show().filter("."+e.val()).hide()}else{if("theme-settings"==h){k.find(".hide-if").filter("."+f.replace(/\s/g,",.")).show().filter("."+e.val()).hide()}}}});if(""!==f){if("custom-panel"==h){var g=k.nextUntil("[data-hide]");g.add(g.find(".themify_field .hide-if")).not(".toggled-off").filter("."+f.replace(/\s/g,",.")).filter("."+e.val()).hide()}else{if("theme-settings"==h){k.find(".hide-if").filter("."+f.replace(/\s/g,",.")).show().filter("."+e.val()).hide()}}}});d.find(".themify_field .preview-icon").on("click",function(f){f.preventDefault();c(this).parent().find(".selected").removeClass("selected");c(this).addClass("selected");c(this).parent().find(".val").val(c(this).find("img").attr("alt")).trigger("change")})};b.dropdownbutton=function(d){d.find(".dropdownbutton-group").each(function(){var f=c(this);f.on("mouseenter mouseleave",".dropdownbutton-list",function(g){g.preventDefault();var h=c(this);if(h.hasClass("disabled")){return false}if(g.type=="mouseenter"){if(!h.children(".dropdownbutton").is(":visible")){h.children(".dropdownbutton").show()}}if(g.type=="mouseleave"){if(h.children(".dropdownbutton").is(":visible")){h.children(".dropdownbutton").hide()}}});f.on("click",".first-ddbtn a",function(g){g.preventDefault()});f.on("click",".ddbtn a",function(m){m.preventDefault();var g=c(this).find("img").attr("src"),n=c(this).data("val"),l=c(this).closest(".dropdownbutton-list"),h=l.attr("id");c(this).closest(".dropdownbutton-list").find(".first-ddbtn img").attr("src",g);c(this).closest(".dropdownbutton").hide();c("input#"+h).val(n);if(l.next().hasClass("ddbtn-all")){var i,k;if(f.hasClass("multi-ddbtn")){i=c(".multi-ddbtn-sub",f.parent().parent());k=c(".multi-ddbtn-sub + input",f.parent().parent())}else{var j=l.next();i=j.prev().siblings(".dropdownbutton-list");k=j.siblings("input")}if(l.next().val()=="yes"){i.addClass("disabled opacity-5");i.each(function(){var o=c(this).data("def-icon");c(this).find(".first-ddbtn img").attr("src",o)});k.val("")}else{i.removeClass("disabled opacity-5")}}});var e=f.find("input.ddbtn-all");if(e.val()=="yes"){if(f.hasClass("multi-ddbtn")){c(".multi-ddbtn-sub",f.parent().parent()).addClass("disabled opacity-5")}else{e.prev().siblings(".dropdownbutton-list").addClass("disabled opacity-5")}}})};b.gallery_shortcode=function(){var g=wp.media.gallery.shortcode,f=wp.media.gallery,d,e;c("body").on("click",".themify-gallery-shortcode-btn",function(i){var h=c(this).closest(".themify_field").find(".themify-gallery-shortcode-input");if(d){d.open()}else{if(c.trim(h.val()).length>0){d=f.edit(c.trim(h.val()))}else{d=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:true,multiple:true,selection:false})}}wp.media.gallery.shortcode=function(j){var l=j.props.toJSON(),k=_.pick(l,"orderby","order");if(j.gallery){_.extend(k,j.gallery.toJSON())}k.ids=j.pluck("id");if(l.uploadedTo){k.id=l.uploadedTo}if(k._orderbyRandom){k.orderby="rand"}delete k._orderbyRandom;if(k.ids&&"post__in"===k.orderby){delete k.orderby}_.each(wp.media.gallery.defaults,function(o,n){if(o===k[n]){delete k[n]}});var m=new wp.shortcode({tag:"gallery",attrs:k,type:"single"});h.val(m.string());wp.media.gallery.shortcode=g;return m};d.on("update",function(j){var k=wp.media.gallery.shortcode(j).string().slice(1,-1);h.val("["+k+"]")});if(c.trim(h.val()).length==0){c(".media-menu").find(".media-menu-item").last().trigger("click")}i.preventDefault()})};b.set_cookie=function(d,e){document.cookie=d+"="+e+"; path=/"};b.get_cookie=function(e){e=e+"=";var d=document.cookie.split(";");for(var f=0;f<d.length;f++){var g=d[f];while(" "==g.charAt(0)){g=g.substring(1,g.length)}if(0==g.indexOf(e)){return g.substring(e.length,g.length)}}return null};b.enable_toggle=function(){var d=c(".enable_toggle");if(d.length>0){d.each(function(){var e=c(this).closest(".themify_write_panel");c(".themify-toggle",e).hide().addClass("toggled-off")})}c(".enable_toggle .preview-icon").on("click",function(h){var f=c(this).find("img").attr("alt"),g=(c.trim(f)!="")?"."+f+"-toggle":".default-toggle";c(this).closest(".inside").find(".themify-toggle").hide().addClass("toggled-off");c(this).closest(".inside").find(g).show().removeClass("toggled-off");h.preventDefault()});c(".enable_toggle .preview-icon.selected").each(function(){var e=c(this).find("img").attr("alt"),f=(e!=""&&e!="default")?"."+e+"-toggle":".default-toggle";c(f).show().removeClass("toggled-off")});c(".enable_toggle input[type=radio]").on("click",function(){var g=c(this).val(),f=(g!=0&&g!="")?"."+g+"-toggle":".default-toggle",e=c(this).siblings("input[type=radio]");e.each(function(){var h=c(this).val();if(h!=0&&h!==""){c("."+h+"-toggle").hide().addClass("toggled-off")}});c(f).each(function(){c(this).show().removeClass("toggled-off");if(c(this).hasClass("enable_toggle_child")){var h=c(this).find("input[type=radio]:checked").siblings("input[type=radio]");h.each(function(){var i=c(this).val();setTimeout(function(){if(i!=0&&i!==""){c("."+i+"-toggle").hide().addClass("toggled-off")}},500)})}})});d.each(function(){var e=c(this).find('input[type="radio"]:checked'),g=e.val(),f=(g!=0&&g!=="")?"."+g+"-toggle":".default-toggle";c(f).each(function(){c(this).show().removeClass("toggled-off");if(c(this).hasClass("enable_toggle_child")){var h=c(this).find("input[type=radio]:checked").siblings("input[type=radio]");h.each(function(){var i=c(this).val();setTimeout(function(){if(i!=0&&i!==""){c("."+i+"-toggle").hide().addClass("toggled-off")}},500)})}})});c('.enable_toggle input[type="checkbox"]').on("click",function(){var f=c(this).data("val"),e=(f!=0&&f!="")?"."+f+"-toggle":".default-toggle";c(this).closest(".inside").find(".themify-toggle").hide().addClass("toggled-off");if(c(this).prop("checked")){c(this).closest(".inside").find(e).show().removeClass("toggled-off")}});c('.enable_toggle input[type="checkbox"]:checked').each(function(){var f=c(this).data("val"),e=(f!=0&&f!=="")?"."+f+"-toggle":".default-toggle";c(e).show().removeClass("toggled-off")})};b.query_category=function(){var f=c(".themify_field"),e=c(".themify-info-link");f.find(".query_category").blur(function(){var h=c(this),g=h.val();c(this).parent().find(".val").val(g);d(h,g)}).keyup(function(){var h=c(this),g=h.val();c(this).parent().find(".val").val(g);d(h,g)});f.find(".query_category_single").change(function(){var h=c(this),g=h.val();h.parent().find(".query_category, .val").val(g);d(h,g)}).closest(".themify_field_row").addClass("query-field-visible");e.closest(".themify_field_row").addClass("query-field-visible");c(".query_category_single, .query_category").each(function(){var h=c(this),g=h.val();d(h,g)});e.closest(".themify_field_row").removeClass("query-field-hide");function d(h,g){if(""!=g){h.closest(".inside").find(".themify_field_row").removeClass("query-field-hide")}else{h.closest(".inside").find(".themify_field_row").not(h.closest(".themify_field_row")).not(".query-field-visible").addClass("query-field-hide")}}};b.post_meta_checkbox=function(){c(".post-meta-group").each(function(){var d=c(this);if(c(".meta-all",d).prop("checked")){c(".meta-sub",d).prop("disabled",true).parent().addClass("opacity-7")}d.on("click",".meta-all",function(){var e=c(this);if(e.prop("checked")){c(".meta-sub",d).prop("disabled",true).prop("checked",false).parent().addClass("opacity-7")}else{c(".meta-sub",d).prop("disabled",false).parent().removeClass("opacity-7")}})});c(".custom-post-meta-group").each(function(){var k=c(this),f=c('input[type="text"]',k).val(),d={},h=[],g=[];if("yes"==f){c(".meta-all",k).val("yes").prop("checked",true);c(".meta-sub",k).val("yes").prop("disabled",true).parent().addClass("opacity-7")}else{g=f.split("&");for(var e=0;e<g.length;e++){h=g[e].split("=");d[h[0]]=h[1]}for(var j in d){if(d.hasOwnProperty(j)){if("yes"==d[j]){c("#"+j,k).val("yes").prop("checked",true)}}}if(c(".meta-all",k).prop("checked")){c(".meta-sub",k).prop("disabled",true).prop("checked",false).parent().addClass("opacity-7")}}k.on("click",".meta-all",function(){var i=c(this);if(i.prop("checked")){c(".meta-sub",k).val("yes").prop("disabled",true).prop("checked",false).parent().addClass("opacity-7");i.val("yes")}else{c(".meta-sub",k).val("no").prop("disabled",false).parent().removeClass("opacity-7");i.val("no")}a(k)});k.on("click",".meta-sub",function(){var i=c(this);if(i.prop("checked")){i.val("yes")}else{i.val("no")}a(k)})})};function a(e){var d="";c('input[type="checkbox"]',e).each(function(){d+=c(this).attr("id")+"="+c(this).val()+"&"});c('input[type="text"]',e).val(d.slice(0,-1))}b.init();return b})(jQuery);