tinymce.PluginManager.add("themifyMenu",function(d,c){function b(){var f=d.settings.color_picker_callback;if(f){return function(){var g=this;f.call(d,function(h){g.value(h).fire("change")},g.value())}}}function e(g){var f={text:g.label,body:{type:g.id},onclick:function(){if(jQuery.isEmptyObject(g.fields)){var i={};i.selectedContent=d.selection.getContent();var j=wp.template("themify-shortcode-"+g.id);d.insertContent(j(i))}else{var h=[];jQuery.each(g.fields,function(k,l){if(l.type=="colorbox"){l.onaction=b()}else{if(l.type=="image"){l={type:"container",label:l.label,layout:"flex",direction:"row",items:[{type:"textbox",name:l.name},{type:"button",text:l.text,onclick:function(){var n=jQuery(this.$el);var m=wp.media.frames.file_frame=wp.media({multiple:false});m.on("select",function(){var o=m.state().get("selection").first().toJSON();n.prev().val(o.url)});m.open()}}]}}else{if(l.type=="iconpicker"){l={type:"container",label:l.label,layout:"flex",direction:"row",items:[{type:"textbox",name:l.name},{type:"button",text:l.text,onclick:function(){var m=jQuery(this.$el);Themify_Icons.target=m.prev();Themify_Icons.showLightbox(Themify_Icons.target.val())}}]}}}}h.push(l)});d.windowManager.open({title:g.label,body:h,onSubmit:function(m){var k=this.toJSON();k.selectedContent=d.selection.getContent();var l=wp.template("themify-shortcode-"+g.id);d.insertContent(l(k))}})}}};return f}var a=[];jQuery.each(themifyEditor.shortcodes,function(f,g){g.id=f;if(typeof g.menu=="object"){var h=[];jQuery.each(g.menu,function(i,j){j.id=i;h.push(e(j))});a.push({text:g.label,menu:h})}else{a.push(e(g))}});d.addButton("btnthemifyMenu",{type:"menubutton",text:"",icon:"themify",tooltip:themifyEditor.editor.menuTooltip,menu:a})});